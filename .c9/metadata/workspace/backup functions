{"filter":false,"title":"backup functions","tooltip":"/backup functions","ace":{"folds":[],"scrolltop":26389,"scrollleft":0,"selection":{"start":{"row":2039,"column":3},"end":{"row":2039,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":1499,"state":"start","mode":"ace/mode/text"}},"hash":"0bfd3658054504dac25c04545db140cd984a8418","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":2054,"column":1},"action":"insert","lines":["/*global $*/","var functions;","var finalImage;","functions =  function() {","\tvar lineWidth;","\tvar lineColor;","\tconsole.log('functionssssssssssssssssssss');","\tvar image3 = false;","","\tvar droppedFaces = 0;","\tconsole.log('ss')","","\t//document.getElementById('all-tools').style.height = document.body.clientHeight;","\t//document.getElementById('right-column').style.height = document.body.clientHeight;","\tif ( $('#paint').length > 0 ) {","\t\tvar canvas = document.querySelector('#paint');","\t\tvar ctx = canvas.getContext('2d');","\t\tvar sketch = document.querySelector('#sketch');","\t\tvar tmp_canvas = document.createElement('canvas');","\t\tvar tmp_ctx = tmp_canvas.getContext('2d');","\t\ttmp_canvas.id = 'tmp_canvas';","\t\t//tmp_canvas.width = canvas.width;","\t\t//tmp_canvas.height = canvas.height;","\t\ttmp_canvas.crossOrigin = \"anonymous\";","\t\tsketch.appendChild(tmp_canvas);","","\t\tcanvas.width = 1500; //horizontal resolution (?) - increase for better looking text","\t\tcanvas.height = 600; //vertical resolution (?) - increase for better looking text","\t\t//canvas.style.width=750;//actual width of canvas","\t\t//canvas.style.height=300;//actual height of canvas","","","\t\ttmp_canvas.width = 1500; //horizontal resolution (?) - increase for better looking text","\t\ttmp_canvas.height = 600; //vertical resolution (?) - increase for better looking text","\t\t//tmp_canvas.style.width=750;//actual width of canvas","\t\t//tmp_canvas.style.height=300;//actual height of canvas","","\t\ttmp_ctx.scale(2, 2);","\t\t//ctx.scale(2,2);","\t\tctx.fillStyle = 'white';","\t\t//$(document).on('click', '#rage-comics-tab', function(){","\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);","\t\t//})","\t\t//tmp_canvas.addEventListener('click', chooseBro);","\t\tif (tool != 'text') {","\t\tvar mouse = {","\t\t\tx: 0","\t\t\t, y: 0","\t\t};","\t\tvar start_mouse = {","\t\t\tx: 0","\t\t\t, y: 0","\t\t};","\t\tvar last_mouse = {","\t\t\tx: 0","\t\t\t, y: 0","\t\t};","","\t\tvar sprayIntervalID;","","\t\t// Pencil Points","\t\tvar ppts = [];","","\t\t//undo array","\t\tvar undo_arr = []; // NEWTHING","","\t\tvar undo_count = 0; // NEWTHING","","\t\tvar empty_canv; // NEWTHING","","\t\t// current tool","","\t\t//NEWTHING","\t\t$('.color-box').on('click', function () {","\t\t\ttmp_ctx.strokeStyle = $(this).attr('id');","\t\t\ttmp_ctx.fillStyle = tmp_ctx.strokeStyle;","\t\t\tconsole.log(tmp_ctx.strokeStyle);","\t\t\tdrawBrush();","\t\t})","","\t\t/* Mouse Capturing Work */","\t\ttmp_canvas.addEventListener('mousemove', function (e) {","\t\t\tmouse.x = typeof e.offsetX !== 'undefined' ? e.offsetX : e.layerX;","\t\t\tmouse.y = typeof e.offsetY !== 'undefined' ? e.offsetY : e.layerY;","\t\t}, false);","","\t\tcanvas.addEventListener('mousemove', function (e) {","\t\t\tmouse.x = typeof e.offsetX !== 'undefined' ? e.offsetX : e.layerX;","\t\t\tmouse.y = typeof e.offsetY !== 'undefined' ? e.offsetY : e.layerY;","\t\t}, false);","\t\t","\t\t//REMOVED","","","\t\t//NEWTHING","\t\tvar drawBrush = function () {","","\t\t\t//context_small.clearRect(0, 0, canvas_small.width, canvas_small.height);","","\t\t\tradius = tmp_ctx.lineWidth;","\t\t\tradius = radius / 2;","","\t\t\t//context_small.beginPath();","\t\t\t//context_small.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);","\t\t\t//context_small.fillStyle = tmp_ctx.strokeStyle;","\t\t\t//context_small.globalAlpha = tmp_ctx.globalAlpha;","\t\t\t//context_small.fill();","","\t\t};","","\t\t/* Drawing on Paint App */","\t\t//tmp_ctx.lineWidth = document.getElementById(\"width_range\").value;","\t\ttmp_ctx.lineWidth = '3';","\t\ttmp_ctx.lineJoin = 'round';","\t\ttmp_ctx.lineCap = 'round';","\t\ttmp_ctx.strokeStyle = lineColor;","\t\ttmp_ctx.fillStyle = 'black';","\t\ttmp_ctx.save();","\t\t//tmp_ctx.globalAlpha = 0.5;","","\t\t//show current brush view  //NEWTHING","\t\tdrawBrush();","","\t\tempty_canv = canvas.toDataURL(); //NEWTHING","\t\tundo_arr.push(empty_canv); //NEWTHING","","\t\ttmp_canvas.addEventListener('mousedown', function (e) {","\t\t\ttmp_canvas.addEventListener('mousemove', onPaint, false);","","\t\t\tmouse.x = typeof e.offsetX !== 'undefined' ? e.offsetX : e.layerX;","\t\t\tmouse.y = typeof e.offsetY !== 'undefined' ? e.offsetY : e.layerY;","","\t\t\tstart_mouse.x = mouse.x;","\t\t\tstart_mouse.y = mouse.y;","","\t\t\tppts.push({","\t\t\t\tx: mouse.x","\t\t\t\t, y: mouse.y","\t\t\t});","","\t\t\t//spraying tool.","\t\t\tsprayIntervalID = setInterval(onPaint, 50);","","\t\t\tonPaint();","\t\t\t//onPaintCircle();","","\t\t}, false);","","\t\tfunction stopDrawing() {","\t\t\ttmp_canvas.removeEventListener('mousemove', onPaint, false);","\t\t\t// for erasing","\t\t\tctx.globalCompositeOperation = 'source-over';","\t\t\t//spraying tool.","\t\t\tclearInterval(sprayIntervalID);","","\t\t\t// Writing down to real canvas now","\t\t\tctx.drawImage(tmp_canvas, 0, 0);","\t\t\t// Clearing tmp canvas","\t\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\t\t// Emptying up Pencil Points","\t\t\tppts = [];","","\t\t\tundo_arr.push(canvas.toDataURL()); //NEWTHING","\t\t\t//window.alert(undo_arr.length);","\t\t\tundo_count = 0; //NEWTHING","\t\t\tpainting = false;","\t\t\tconsole.log(painting)","\t\t}","\t\tfunction stopDrawing2() {","\t\t\tif ( painting === true ) {","\t\t\t\tstopDrawing()","\t\t\t}","\t\t}","","\t\ttmp_canvas.addEventListener('mouseup', stopDrawing, false);","\t\ttmp_canvas.addEventListener('mouseleave', stopDrawing2, false);","\t\ttmp_canvas.addEventListener('ondrag', stopDrawing2, false);","","\t\t//NEWTHING","","\t\tdocument.getElementById(\"undo\").addEventListener(\"click\", function () {","","\t\t\t/*window.alert(undo_count);","\t\t\twindow.alert(undo_arr.length);*/","","\t\t\tif (undo_arr.length > 1) {","","\t\t\t\tif (undo_count + 1 < undo_arr.length) {","\t\t\t\t\tif (undo_count + 2 == undo_arr.length) {","\t\t\t\t\t\tif (confirm(\"Do you really want to UNDO ??? WARNING ! You will not be able to REDO this step \")) {","\t\t\t\t\t\t\tundo_count++;","\t\t\t\t\t\t\tUndoFunc(undo_count);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tundo_count++;","\t\t\t\t\t\t//window.alert(undo_count);","\t\t\t\t\t\tUndoFunc(undo_count);","\t\t\t\t\t}","","\t\t\t\t\tif (undo_count + 1 == undo_arr.length) {","\t\t\t\t\t\tundo_count = 0;","\t\t\t\t\t\tundo_arr = [];","\t\t\t\t\t\tundo_arr.push(empty_canv);","\t\t\t\t\t}","","\t\t\t\t}","","\t\t\t\t//else { undo_count = 0; undo_arr = []; undo_arr.push(empty_canv); }","\t\t\t}","","\t\t});","","\t\tdocument.getElementById(\"redo\").addEventListener(\"click\", function () {","\t\t\tif (undo_count > 0) {","\t\t\t\tundo_count--;","\t\t\t\tUndoFunc(undo_count);","\t\t\t}","","\t\t});","","\t\tdocument.getElementById(\"clear\").addEventListener(\"click\", function () {","\t\t\t//.//$('.dragged, .textareas').remove();","\t\t\tdroppedFaces = 0;","\t\t\ttextCalls = 0;","\t\t\t$('#placeholder-1').droppable({","\t\t\t\tdisabled: false,","\t\t\t});","\t\t\t\tcanvas.height = 600;","\t\t\t\ttmp_canvas.height = 600;","\t\t\t\t$('#sketch, #paint, #tmp_canvas').css({'height':'300px'});","\t\t\t\t$('.splitter').not('#splitter-1').remove();","\t\t\t\t$('#splitter-1').html('unsplit')","\t\t\t\t$('.placeholder').not('#placeholder-1').remove();","\t\t\t\t$('#remove-panel-button').hide();","\t\t\t\tsketch.style.height = 300 + 'px';","\t\t\t\tctx.fillStyle = \"white\";","\t\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);","\t\t\t\t//document.getElementsByClassName('splitter').innerHTML = 'split';","\t\t\t\tctx.strokeStyle = 'black';","\t\t\t\tctx.lineWidth = 3;","\t\t\t\tctx.beginPath();","\t\t\t\tctx.moveTo(750, 1);","\t\t\t\tctx.lineTo(750, 599);","\t\t\t\tctx.stroke();","\t\t\t\ttmp_ctx.scale(2,2);","\t\t\t\ttmp_ctx.lineWidth = lineWidth;","\t\t\t\ttmp_ctx.lineJoin = 'round';","\t\t\t\ttmp_ctx.lineCap = 'round';","\t\t\t\ttmp_ctx.strokeStyle = lineColor;","\t\t\t\ttmp_ctx.fillStyle = 'black';","\t\t\t\ttmp_ctx.lineWidth = lineWidth;","\t\t\t\t//alert(lineWidth);","","\t\t});","","\t}","\tvar onPaintCircle = function () {","","\t\t// Tmp canvas is always cleared up before drawing.","\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\tvar x = (mouse.x + start_mouse.x) / 2;","\t\tvar y = (mouse.y + start_mouse.y) / 2;","","\t\tvar radius = Math.max(","\t\t\tMath.abs(mouse.x - start_mouse.x)","\t\t\t, Math.abs(mouse.y - start_mouse.y)","\t\t) / 2;","","\t\ttmp_ctx.beginPath();","\t\ttmp_ctx.arc(x, y, radius, 0, Math.PI * 2, false);","\t\t// tmp_ctx.arc(x, y, 5, 0, Math.PI*2, false);","\t\ttmp_ctx.stroke();","\t\ttmp_ctx.closePath();","","\t};","","\tvar onPaintBrush = function () {","","\t\t// Saving all the points in an array","\t\tppts.push({","\t\t\tx: mouse.x","\t\t\t, y: mouse.y","\t\t});","","\t\tif (ppts.length < 3) {","\t\t\tvar b = ppts[0];","\t\t\ttmp_ctx.beginPath();","\t\t\t//ctx.moveTo(b.x, b.y);","\t\t\t//ctx.lineTo(b.x+50, b.y+50);","\t\t\ttmp_ctx.arc(b.x, b.y, tmp_ctx.lineWidth / 2, 0, Math.PI * 2, !0);","\t\t\ttmp_ctx.fill();","\t\t\ttmp_ctx.closePath();","","\t\t\treturn;","\t\t}","","\t\t// Tmp canvas is always cleared up before drawing.","\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\ttmp_ctx.beginPath();","\t\ttmp_ctx.moveTo(ppts[0].x, ppts[0].y);","","\t\tfor (var i = 1; i < ppts.length - 2; i++) {","\t\t\tvar c = (ppts[i].x + ppts[i + 1].x) / 2;","\t\t\tvar d = (ppts[i].y + ppts[i + 1].y) / 2;","","\t\t\ttmp_ctx.quadraticCurveTo(ppts[i].x, ppts[i].y, c, d);","\t\t}","","\t\t// For the last 2 points","\t\ttmp_ctx.quadraticCurveTo(","\t\t\tppts[i].x","\t\t\t, ppts[i].y","\t\t\t, ppts[i + 1].x","\t\t\t, ppts[i + 1].y","\t\t);","\t\ttmp_ctx.stroke();","","\t};","","\tvar onPaintLine = function () {","","\t\t// Tmp canvas is always cleared up before drawing.","\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\ttmp_ctx.beginPath();","\t\ttmp_ctx.moveTo(start_mouse.x, start_mouse.y);","\t\ttmp_ctx.lineTo(mouse.x, mouse.y);","\t\ttmp_ctx.stroke();","\t\ttmp_ctx.closePath();","","\t};","","\tvar onPaintRect = function () {","","\t\t// Tmp canvas is always cleared up before drawing.","\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\tvar x = Math.min(mouse.x, start_mouse.x);","\t\tvar y = Math.min(mouse.y, start_mouse.y);","\t\tvar width = Math.abs(mouse.x - start_mouse.x);","\t\tvar height = Math.abs(mouse.y - start_mouse.y);","\t\ttmp_ctx.strokeRect(x, y, width, height);","","\t};","","\tfunction drawEllipse(ctx) {","","\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\tvar x = Math.min(mouse.x, start_mouse.x);","\t\tvar y = Math.min(mouse.y, start_mouse.y);","","\t\tvar w = Math.abs(mouse.x - start_mouse.x);","\t\tvar h = Math.abs(mouse.y - start_mouse.y);","","\t\tvar kappa = .5522848","\t\t\t, ox = (w / 2) * kappa, // control point offset horizontal","\t\t\toy = (h / 2) * kappa, // control point offset vertical","\t\t\txe = x + w, // x-end","\t\t\tye = y + h, // y-end","\t\t\txm = x + w / 2, // x-middle","\t\t\tym = y + h / 2; // y-middle","","\t\tctx.beginPath();","\t\tctx.moveTo(x, ym);","\t\tctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);","\t\tctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);","\t\tctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);","\t\tctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);","\t\tctx.closePath();","\t\tctx.stroke();","\t};","\tvar toErase = false;","\tvar onErase = function () {","\t\tif (toErase === true ){","\t\t\t// Saving all the points in an array","\t\tppts.push({","\t\t\tx: mouse.x","\t\t\t, y: mouse.y","\t\t});","","\t\tctx.globalCompositeOperation = 'destination-out';","\t\tctx.fillStyle = 'white';","\t\tctx.strokeStyle = 'white';","\t\tctx.lineWidth = tmp_ctx.lineWidth;","","\t\tif (ppts.length < 3) {","\t\t\tvar b = ppts[0];","\t\t\tctx.beginPath();","\t\t\t//ctx.moveTo(b.x, b.y);","\t\t\t//ctx.lineTo(b.x+50, b.y+50);","\t\t\tctx.arc(b.x, b.y, ctx.lineWidth / 2, 0, Math.PI * 2, !0);","\t\t\tctx.fill();","\t\t\tctx.closePath();","","\t\t\treturn;","\t\t}","","\t\t// Tmp canvas is always cleared up before drawing.","\t\t// ctx.clearRect(0, 0, canvas.width, canvas.height);","","\t\tctx.beginPath();","\t\tctx.moveTo(ppts[0].x, ppts[0].y);","","\t\tfor (var i = 1; i < ppts.length - 2; i++) {","\t\t\tvar c = (ppts[i].x + ppts[i + 1].x) / 2;","\t\t\tvar d = (ppts[i].y + ppts[i + 1].y) / 2;","","\t\t\tctx.quadraticCurveTo(ppts[i].x, ppts[i].y, c, d);","\t\t}","","\t\t// For the last 2 points","\t\tctx.quadraticCurveTo(","\t\t\tppts[i].x","\t\t\t, ppts[i].y","\t\t\t, ppts[i + 1].x","\t\t\t, ppts[i + 1].y","\t\t);","\t\tctx.stroke();","\t\t}","\t\t// Else erase","\t\telse {","\t\t\ttmp_ctx.strokeStyle = '#ffffff';","\t\t\t// Saving all the points in an array","\t\tppts.push({","\t\t\tx: mouse.x","\t\t\t, y: mouse.y","\t\t});","","\t\tif (ppts.length < 3) {","\t\t\tvar b = ppts[0];","\t\t\ttmp_ctx.beginPath();","\t\t\t//ctx.moveTo(b.x, b.y);","\t\t\t//ctx.lineTo(b.x+50, b.y+50);","\t\t\ttmp_ctx.arc(b.x, b.y, tmp_ctx.lineWidth / 2, 0, Math.PI * 2, !0);","\t\t\ttmp_ctx.fill();","\t\t\ttmp_ctx.closePath();","","\t\t\treturn;","\t\t}","","\t\t// Tmp canvas is always cleared up before drawing.","\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\ttmp_ctx.beginPath();","\t\ttmp_ctx.moveTo(ppts[0].x, ppts[0].y);","","\t\tfor (var i = 1; i < ppts.length - 2; i++) {","\t\t\tvar c = (ppts[i].x + ppts[i + 1].x) / 2;","\t\t\tvar d = (ppts[i].y + ppts[i + 1].y) / 2;","","\t\t\ttmp_ctx.quadraticCurveTo(ppts[i].x, ppts[i].y, c, d);","\t\t}","","\t\t// For the last 2 points","\t\ttmp_ctx.quadraticCurveTo(","\t\t\tppts[i].x","\t\t\t, ppts[i].y","\t\t\t, ppts[i + 1].x","\t\t\t, ppts[i + 1].y","\t\t);","\t\ttmp_ctx.stroke();","\t\t}","","\t};","","\tvar getRandomOffset = function (radius) {","","\t\tvar random_angle = Math.random() * (2 * Math.PI);","\t\tvar random_radius = Math.random() * radius;","","\t\t// console.log(random_angle, random_radius, Math.cos(random_angle), Math.sin(random_angle));","","\t\treturn {","\t\t\tx: Math.cos(random_angle) * random_radius","\t\t\t, y: Math.sin(random_angle) * random_radius","\t\t};","\t};","","\tvar generateSprayParticles = function () {","\t\t// Particle count, or, density","\t\tvar density = tmp_ctx.lineWidth * 2;","","\t\tfor (var i = 0; i < density; i++) {","\t\t\tvar offset = getRandomOffset(tmp_ctx.lineWidth);","","\t\t\tvar x = mouse.x + offset.x;","\t\t\tvar y = mouse.y + offset.y;","","\t\t\ttmp_ctx.fillRect(x, y, 1, 1);","\t\t}","\t};","","\tvar UndoFunc = function (count) {","","\t\tvar number = undo_arr.length;","\t\tvar img_data = undo_arr[number - (count + 1)];","\t\tvar undo_img = new Image();","","\t\tundo_img.src = img_data.toString();","","\t\tctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","\t\tctx.drawImage(undo_img, 0, 0);","","\t\t//window.alert('undoing');","","\t};","\tvar onPaint = function () {","\t\tpainting = true;","\t\tif (tool == 'brush') {","\t\t\tonPaintBrush();","\t\t} else if (tool == 'circle') {","\t\t\tonPaintCircle();","\t\t} else if (tool == 'line') {","\t\t\tonPaintLine();","\t\t} else if (tool == 'rectangle') {","\t\t\tonPaintRect();","\t\t} else if (tool == 'text-#d40000' || tool == 'text-black') {","\t\t\ttmp_canvas.addEventListener('click', createText, false);","\t\t\t//textCalls++;","\t\t\ttmp_canvas.style.cursor = 'text';","\t\t} else if (tool == 'ellipse') {","\t\t\tdrawEllipse(tmp_ctx);","\t\t} else if (tool == 'eraser') {","\t\t\tonErase();","\t\t} else if (tool == 'spray') {","\t\t\tgenerateSprayParticles();","\t\t} else if (tool == 'edit') {","\t\t\t//none();","\t\t}","","\t};","\t}","","\t//if ( $('#sketch').length > 0 ) {","","\t//}","","\t//canvas.crossOrigin=\"anonymous\";","","\tvar textCalls = 0;","","\t// Creating a tmp canvas","","/*\t$(document).on('click', '#button', function(){","\t\talert('ss');","\t\tvar tmp_canvas = document.createElement('canvas');","\t\tvar tmp_ctx = tmp_canvas.getContext('2d');","\t\ttmp_ctx.fillText(document.getElementById('text-' + '1').value.toUpperCase(), Number(document.getElementById('text-' + '1').parentElement.parentElement.offsetLeft) + Number(document.getElementById('text-' + '1').parentElement.offsetLeft) + 10, Number(document.getElementById('text-' + '1').parentElement.parentElement.offsetTop) + Number(document.getElementById('text-' + '1').parentElement.offsetTop) + 15);","\t});*/","","","\tvar tool = 'none';","\tlineWidth = '3';","\tlineColor = 'black';","","\t//function chooseBro() {","\t//\t$('#talking').fadeIn(200).fadeOut(1300);","\t//}","","","\t$('#tools .direct-tools').on('click', function () {","","\t\t$('#shapes-button, #texts-button').css({","\t\t\t//'border-bottom': '0px solid #d40000',","\t\t\t//'color':'black'","\t\t});","","\t\ttool = $(this).attr('id');","\t\t//$('.rageface').toggleClass('rageface');","\t\t$('#tools .direct-tools').not(this).css({","\t\t'border': 'none',","\t\t\t'background': 'white',","\t\t\t//, 'color': 'black'","\t\t\t\t//\"box-shadow\": \"inset 0px 0px 0px 0px #D40000\",","\t\t\t\t  //\"background\": \"#424242\"","\t\t});","","\t\t$(this).css({","\t\t\t 'background': '#efefed'","\t\t, 'border': '#ff3000 1px solid'","\t//,\"box-shadow\": \"inset 0px 0px 0px 3px #D40000\"","\t\t\t\t//  'background': 'white'","\t\t});","\t\tconsole.log(lineWidth);","","\t\tfunction lowerIndex() {","\t\t\t$('.text-parent .ui-wrapper').css({","\t\t\t\t'z-index': '1'","\t\t\t}).addClass('hidden-textareas');","\t\t\t$('.img-parent .ui-wrapper, #placeholder-wrapper').css({","\t\t\t\t'z-index': '1',","\t\t\t});","\t\t\t$('.dragged-helper, .ui-wrapper').removeClass('dragged-shadow');","\t\t\t//$(tmp_canvas).css({'cursor':'crosshair'});","\t\t\t$(tmp_canvas).removeClass('default-cursor');","\t\t\t$('.ui-resizable-handle').addClass('transparent-handle');","\t\t\t$('.textareas').addClass('no-border');","\t\t\t//$('#canvas').css({'border':'red 5px solid'});","\t\t}","","\t\tfunction imgIndex() {","\t\t\t$('.text-parent .ui-wrapper').css({","\t\t\t\t'z-index': '1'","\t\t\t});","\t\t\t$('.img-parent .ui-wrapper').css({","\t\t\t\t'z-index': '4'","\t\t\t});","\t\t\t$('#placeholder-wrapper').css({","\t\t\t\t'z-index': '3'","\t\t\t});","\t\t\t$('.dragged-helper, .ui-wrapper').removeClass('dragged-shadow');","\t\t\t$(tmp_canvas).removeClass('default-cursor');","\t\t\t$('.img-parent .ui-resizable-handle').removeClass('transparent-handle');","\t\t\t$('.text-parent .ui-resizable-handle').addClass('transparent-handle');","\t\t\t$('.textareas').addClass('no-border');","\t\t\t$('.text-parent .delete-handle').hide();","\t\t\t//$('#canvas').css({'border':'green 5px solid'});","\t\t}","","\t\tfunction textIndex() {","\t\t\t$('.img-parent .ui-wrapper, #placeholder-wrapper').css({","\t\t\t\t'z-index': '1'","\t\t\t});","\t\t\t$('.text-parent .ui-wrapper').css({","\t\t\t\t'z-index': '3'","\t\t\t}).removeClass('hidden-textareas');","\t\t\t$('.dragged-helper, .ui-wrapper').removeClass('dragged-shadow');","\t\t\t$(tmp_canvas).removeClass('default-cursor');","\t\t\t$('.text-parent .ui-resizable-handle').removeClass('transparent-handle');","\t\t\t$('.img-parent .ui-resizable-handle').addClass('transparent-handle');","\t\t\t$('.textareas').removeClass('no-border');","\t\t\t$('.text-parent .delete-handle').show();","\t\t\t//$('#paint').css({'border':'blue 5px solid'});","\t\t};","","\t\tfunction upperIndex() {","\t\t\t$('.img-parent .ui-wrapper, .text-parent .ui-wrapper').css({","\t\t\t\t'z-index': '4'","\t\t\t});","\t\t\t$('#placeholder-wrapper').css({","\t\t\t\t'z-index': '3'","\t\t\t});","\t\t\t$('.dragged-helper, .ui-wrapper').addClass('dragged-shadow');","\t\t\t//$(tmp_canvas).css({'cursor':'crosshair'});","\t\t\t$(tmp_canvas).addClass('default-cursor');","\t\t\t$('.ui-resizable-handle').fadeIn();","\t\t\t//$('#tmp_canvas').css({'border':'1px green solid'})","\t\t}","\t\t//console.log(tool);","\t\tif (tool == 'text-#d40000') {","\t\t\ttmp_canvas.style.cursor = \"text\";","\t\t\ttextIndex();","\t\t} else if (tool == 'text-black') {","\t\t\ttmp_canvas.style.cursor = \"text\";","\t\t\ttextIndex();","\t\t\t//alert('sds');","\t\t} else if (tool == 'edit') {","\t\t\ttmp_canvas.style.cursor = \"move\";","\t\t\timgIndex();","\t\t} else if (tool == 'brush') {","\t\t\ttmp_ctx.strokeStyle = lineColor;","\t\t\ttmp_canvas.style.cursor = \"url('assets/pen.cur'), auto\";","\t\t\tlowerIndex();","\t\t} else if (tool == 'spray') {","\t\t\ttmp_canvas.style.cursor = \"url('assets/spray.cur'), auto\";","\t\t\tlowerIndex();","","\t\t} else if (tool == 'eraser') {","\t\t\ttmp_canvas.style.cursor = \"url('assets/eraser.cur'), auto\";","\t\t\tlowerIndex();","\t\t} else if (tool == 'none') {","\t\t\talert('mmm');","\t\t} else {","\t\t\tconsole.log('other')","\t\t\ttmp_canvas.style.cursor = \"crosshair\";","\t\t}","\t\tlineSize();","","\t\tfunction lineSize() {","\t\t\t$('.line-wrapper').click(function () {","\t\t\t\tvar linesize = $(this).attr('id');","\t\t\t\t//tmp_ctx.lineWidth =","\t\t\t\tif (linesize == 'line1') {","\t\t\t\t\tlineWidth = 2;","\t\t\t\t\ttmp_ctx.lineWidth = 2;","\t\t\t\t} else if (linesize == 'line2') {","\t\t\t\t\tlineWidth = 3;","\t\t\t\t\ttmp_ctx.lineWidth = 3;","\t\t\t\t} else {","\t\t\t\t\tlineWidth = 6;","\t\t\t\t\ttmp_ctx.lineWidth = 6;","\t\t\t\t}","\t\t\t})","\t\t}","\t\t//$('#addRageFaces').on('click', function(){","\t\t//  tool = 'none';","\t\t//  $('#tools button').css({","\t\t//  \"box-shadow\": \"inset 0px 0px 0px 0px #D40000\",","\t\t//  'background': 'whitesmoke'","\t\t//  });","\t\t//});","","\t\tconsole.log(tool);","","\t});","\t//  COLOR FUNCTION","","\t$('.color-box').click(function () {","\t\t//tool = $(this).attr('id');","\t\t$('.color-box').parent().css({","\t\t\t//\"border\": \"1px solid #616161\"","\t\t\t'box-shadow': 'none'","\t\t, });","\t\t$(this).parent().css({","\t\t\t//\"border\": \"1px solid #F15247\"","\t\t\t'box-shadow': '3px 3px 1px rgba(0,0,0,0.4)'","\t\t, });","\t\tlineColor = $(this).attr('id');","\t\t$('.dot').css({'background':lineColor})","\t});","\t//$('#line2').click();","\t$('#000000').click();","","","","","","\tfunction callDownload(link, canvasId, filename, todownload) {","\t\t//document.getElementById('paint').crossOrigin=\"anonymous\";","\t\tvar downloadCANVAS = document.createElement('canvas');","\t\tdownloadCANVAS.setAttribute('id', 'downloadCanvas');","\t\tdownloadCTX = downloadCANVAS.getContext('2d');","\t\tdownloadCANVAS.width = canvas.width;","\t\tdownloadCANVAS.height = canvas.height;","\t\toriginalCanvas = ctx.getImageData(0,0,canvas.width,canvas.height);","\t\tdownloadCTX.putImageData(originalCanvas,0,0);","\t\t//downloadCTX.fillStyle = 'black';","\t\tdownloadCTX.font=\"20px schoolbell\";","\t\tdownloadCTX.scale(2,2);","\t\tdownloadCANVAS.getContext('2d').font=\"schoolbell\";","\t\tdownloadCTX.save()","","\t\t\t\tdownloadCTX.fillStyle = \"black\";","\t\t\t\t//downloadCTX.fillText('text',-4,10);","\t\t\t\t//REMOVED","\t\t\t\t//var added1 = $('#text-11').val()","\t\t\t\t//var added3 = $('#text-22').val()","\t\t//downloadCTX.scale(0.5,0.5);","\t\tfor (var droppedNumbers = 1; droppedNumbers <= droppedFaces; ++droppedNumbers) {","\t\t\tif (  $(\"#rage-\" + droppedNumbers).hasClass('panel2') ) {","\t\t\t\tvar image = document.getElementById(\"rage-\" + droppedNumbers);","\t\t\t$(image).attr('crossOrigin', '')","\t\t\tvar originalImage = new Image();","\t\t\t$(originalImage).attr('crossOrigin', '')","\t\t\toriginalImage.src = image.src;","\t\t\toriginalImage.crossOrigin = \"\";","\t\t\tctx.ImageSmoothingEnabled = false;","\t\t\t//ctx.webkitImageSmoothingEnabled = false;","\t\t\tctx.mozImageSmoothingEnabled = false;","","\t\t\t//var img = document.getElementsByTagName('img')[0];","\t\t\tvar canvas2 = document.createElement('canvas');","\t\t\tcanvas2.width = originalImage.width;","\t\t\tcanvas2.height = originalImage.height;","","\t\t\tcanvas2.getContext('2d').drawImage(originalImage, 0, 0);","\t\t\tcanvas2.crossOrigin = \"Anonymous\";","\t\t\tcanvas.crossOrigin = \"Anonymous\";","\t\t\tfunction downScaleCanvas(cv, scale) {","\t\t\t\tif (!(scale < 1) || !(scale > 0)) {","\t\t\t\t\tdownloadCTX.drawImage(originalImage, Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetLeft) + Number(document.getElementById('paint').offsetLeft), Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetTop) + Number(document.getElementById('paint').offsetTop), image.width, image.height);","\t\t\t\t}","\t\t\t\tvar sqScale = scale * scale; // square scale = area of source pixel within target","\t\t\t\tvar sw = cv.width; // source image width","\t\t\t\tvar sh = cv.height; // source image height","\t\t\t\tvar tw = Math.floor(sw * scale); // target image width","\t\t\t\tvar th = Math.floor(sh * scale); // target image height","\t\t\t\tvar sx = 0","\t\t\t\t\t, sy = 0","\t\t\t\t\t, sIndex = 0; // source x,y, index within source array","\t\t\t\tvar tx = 0","\t\t\t\t\t, ty = 0","\t\t\t\t\t, yIndex = 0","\t\t\t\t\t, tIndex = 0; // target x,y, x,y index within target array","\t\t\t\tvar tX = 0","\t\t\t\t\t, tY = 0; // rounded tx, ty","\t\t\t\tvar w = 0","\t\t\t\t\t, nw = 0","\t\t\t\t\t, wx = 0","\t\t\t\t\t, nwx = 0","\t\t\t\t\t, wy = 0","\t\t\t\t\t, nwy = 0; // weight / next weight x / y","\t\t\t\t// weight is weight of current source point within target.","\t\t\t\t// next weight is weight of current source point within next target's point.","\t\t\t\tvar crossX = false; // does scaled px cross its current px right border ?","\t\t\t\tvar crossY = false; // does scaled px cross its current px bottom border ?","\t\t\t\t//var imgg = new Image();","\t\t\t\t//imgg.setAttribute('crossOrigin', 'anonymous');","\t\t\t\t//imgg.src = cv.toDataURL();","","\t\t\t\tvar sBuffer = cv.getContext('2d').","\t\t\t\tgetImageData(0, 0, sw, sh).data; // source buffer 8 bit rgba","","","\t\t\t\tvar tBuffer = new Float32Array(4 * sw * sh); // target buffer Float32 rgb","\t\t\t\tvar sR = 0","\t\t\t\t\t, sG = 0","\t\t\t\t\t, sB = 0; // source's current point r,g,b","\t\t\t\t// untested !","\t\t\t\tvar sA = 0; //source alpha","","\t\t\t\tfor (sy = 0; sy < sh; sy++) {","\t\t\t\t\tty = sy * scale; // y src position within target","\t\t\t\t\ttY = 0 | ty; // rounded : target pixel's y","\t\t\t\t\tyIndex = 4 * tY * tw; // line index within target array","\t\t\t\t\tcrossY = (tY != (0 | ty + scale));","\t\t\t\t\tif (crossY) { // if pixel is crossing botton target pixel","\t\t\t\t\t\twy = (tY + 1 - ty); // weight of point within target pixel","\t\t\t\t\t\tnwy = (ty + scale - tY - 1); // ... within y+1 target pixel","\t\t\t\t\t}","\t\t\t\t\tfor (sx = 0; sx < sw; sx++, sIndex += 4) {","\t\t\t\t\t\ttx = sx * scale; // x src position within target","\t\t\t\t\t\ttX = 0 | tx; // rounded : target pixel's x","\t\t\t\t\t\ttIndex = yIndex + tX * 4; // target pixel index within target array","\t\t\t\t\t\tcrossX = (tX != (0 | tx + scale));","\t\t\t\t\t\tif (crossX) { // if pixel is crossing target pixel's right","\t\t\t\t\t\t\twx = (tX + 1 - tx); // weight of point within target pixel","\t\t\t\t\t\t\tnwx = (tx + scale - tX - 1); // ... within x+1 target pixel","\t\t\t\t\t\t}","\t\t\t\t\t\tsR = sBuffer[sIndex]; // retrieving r,g,b for curr src px.","\t\t\t\t\t\tsG = sBuffer[sIndex + 1];","\t\t\t\t\t\tsB = sBuffer[sIndex + 2];","\t\t\t\t\t\tsA = sBuffer[sIndex + 3];","","\t\t\t\t\t\tif (!crossX && !crossY) { // pixel does not cross","\t\t\t\t\t\t\t// just add components weighted by squared scale.","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * sqScale;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * sqScale;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * sqScale;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * sqScale;","\t\t\t\t\t\t} else if (crossX && !crossY) { // cross on X only","\t\t\t\t\t\t\tw = wx * scale;","\t\t\t\t\t\t\t// add weighted component for current px","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * w;","\t\t\t\t\t\t\t// add weighted component for next (tX+1) px","\t\t\t\t\t\t\tnw = nwx * scale","\t\t\t\t\t\t\ttBuffer[tIndex + 4] += sR * nw; // not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 5] += sG * nw; // not 4","\t\t\t\t\t\t\ttBuffer[tIndex + 6] += sB * nw; // not 5","\t\t\t\t\t\t\ttBuffer[tIndex + 7] += sA * nw; // not 6","\t\t\t\t\t\t} else if (crossY && !crossX) { // cross on Y only","\t\t\t\t\t\t\tw = wy * scale;","\t\t\t\t\t\t\t// add weighted component for current px","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * w;","\t\t\t\t\t\t\t// add weighted component for next (tY+1) px","\t\t\t\t\t\t\tnw = nwy * scale","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw] += sR * nw; // *4, not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 1] += sG * nw; // *4, not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 2] += sB * nw; // *4, not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 3] += sA * nw; // *4, not 3","\t\t\t\t\t\t} else { // crosses both x and y : four target points involved","\t\t\t\t\t\t\t// add weighted component for current px","\t\t\t\t\t\t\tw = wx * wy;","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * w;","\t\t\t\t\t\t\t// for tX + 1; tY px","\t\t\t\t\t\t\tnw = nwx * wy;","\t\t\t\t\t\t\ttBuffer[tIndex + 4] += sR * nw; // same for x","\t\t\t\t\t\t\ttBuffer[tIndex + 5] += sG * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 6] += sB * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 7] += sA * nw;","\t\t\t\t\t\t\t// for tX ; tY + 1 px","\t\t\t\t\t\t\tnw = wx * nwy;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw] += sR * nw; // same for mul","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 1] += sG * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 2] += sB * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 3] += sA * nw;","\t\t\t\t\t\t\t// for tX + 1 ; tY +1 px","\t\t\t\t\t\t\tnw = nwx * nwy;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 4] += sR * nw; // same for both x and y","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 5] += sG * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 6] += sB * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 7] += sA * nw;","\t\t\t\t\t\t}","\t\t\t\t\t} // end for sx","\t\t\t\t} // end for sy","","\t\t\t\t// create result canvas","\t\t\t\tvar resCV = document.createElement('canvas');","\t\t\t\tresCV.width = tw;","\t\t\t\tresCV.height = th;","\t\t\t\tvar resCtx = resCV.getContext('2d');","\t\t\t\tvar imgRes = resCtx.getImageData(0, 0, tw, th);","\t\t\t\tvar tByteBuffer = imgRes.data;","\t\t\t\t// convert float32 array into a UInt8Clamped Array","\t\t\t\tvar pxIndex = 0; //","\t\t\t\tfor (sIndex = 0, tIndex = 0; pxIndex < tw * th; sIndex += 4, tIndex += 4, pxIndex++) {","\t\t\t\t\ttByteBuffer[tIndex] = Math.ceil(tBuffer[sIndex]);","\t\t\t\t\ttByteBuffer[tIndex + 1] = Math.ceil(tBuffer[sIndex + 1]);","\t\t\t\t\ttByteBuffer[tIndex + 2] = Math.ceil(tBuffer[sIndex + 2]);","\t\t\t\t\ttByteBuffer[tIndex + 3] = Math.ceil(tBuffer[sIndex + 3]);","\t\t\t\t}","\t\t\t\t// writing result to canvas.","\t\t\t\tresCtx.putImageData(imgRes, 0, 0);","\t\t\t\t//downloadCTX.scale(2,2);","\t\t\t\tdownloadCTX.drawImage(resCV, Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetLeft) + Number(document.getElementById('paint').offsetLeft), Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetTop) + Number(document.getElementById('paint').offsetTop), image.width + addedX, image.height + addedY);","\t\t\t\tresCtx.clearRect(0,0,resCV.width,resCV.height);","\t\t\t\t//stopDrawing();","\t\t\t\t//return resCV;","\t\t\t}","\t\t\tvar theScale = image.width *2 / originalImage.width;","\t\t\tvar addedX = 0;","\t\t\tvar addedY = 0;","","\t\t\tdownScaleCanvas(canvas2, theScale);","\t\t\t}","","\t\t}","\t\tfor (var droppedNumbers = 1; droppedNumbers <= droppedFaces; ++droppedNumbers) {","\t\t\tif (  !$(\"#rage-\" + droppedNumbers).hasClass('panel2') ) {","\t\t\t\tvar image = document.getElementById(\"rage-\" + droppedNumbers);","\t\t\t$(image).attr('crossOrigin', '')","\t\t\tvar originalImage = new Image();","\t\t\t$(originalImage).attr('crossOrigin', '')","\t\t\toriginalImage.src = image.src;","\t\t\toriginalImage.crossOrigin = \"\";","\t\t\tctx.ImageSmoothingEnabled = false;","\t\t\t//ctx.webkitImageSmoothingEnabled = false;","\t\t\tctx.mozImageSmoothingEnabled = false;","","\t\t\t//var img = document.getElementsByTagName('img')[0];","\t\t\tvar canvas2 = document.createElement('canvas');","\t\t\tcanvas2.width = originalImage.width;","\t\t\tcanvas2.height = originalImage.height;","","\t\t\tcanvas2.getContext('2d').drawImage(originalImage, 0, 0);","\t\t\tcanvas2.crossOrigin = \"Anonymous\";","\t\t\tcanvas.crossOrigin = \"Anonymous\";","\t\t\tfunction downScaleCanvas(cv, scale) {","\t\t\t\tif (!(scale < 1) || !(scale > 0)) {","\t\t\t\t\tdownloadCTX.drawImage(originalImage, Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetLeft) + Number(document.getElementById('paint').offsetLeft), Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetTop) + Number(document.getElementById('paint').offsetTop), image.width, image.height);","\t\t\t\t}","\t\t\t\tvar sqScale = scale * scale; // square scale = area of source pixel within target","\t\t\t\tvar sw = cv.width; // source image width","\t\t\t\tvar sh = cv.height; // source image height","\t\t\t\tvar tw = Math.floor(sw * scale); // target image width","\t\t\t\tvar th = Math.floor(sh * scale); // target image height","\t\t\t\tvar sx = 0","\t\t\t\t\t, sy = 0","\t\t\t\t\t, sIndex = 0; // source x,y, index within source array","\t\t\t\tvar tx = 0","\t\t\t\t\t, ty = 0","\t\t\t\t\t, yIndex = 0","\t\t\t\t\t, tIndex = 0; // target x,y, x,y index within target array","\t\t\t\tvar tX = 0","\t\t\t\t\t, tY = 0; // rounded tx, ty","\t\t\t\tvar w = 0","\t\t\t\t\t, nw = 0","\t\t\t\t\t, wx = 0","\t\t\t\t\t, nwx = 0","\t\t\t\t\t, wy = 0","\t\t\t\t\t, nwy = 0; // weight / next weight x / y","\t\t\t\t// weight is weight of current source point within target.","\t\t\t\t// next weight is weight of current source point within next target's point.","\t\t\t\tvar crossX = false; // does scaled px cross its current px right border ?","\t\t\t\tvar crossY = false; // does scaled px cross its current px bottom border ?","\t\t\t\t//var imgg = new Image();","\t\t\t\t//imgg.setAttribute('crossOrigin', 'anonymous');","\t\t\t\t//imgg.src = cv.toDataURL();","","\t\t\t\tvar sBuffer = cv.getContext('2d').","\t\t\t\tgetImageData(0, 0, sw, sh).data; // source buffer 8 bit rgba","","","\t\t\t\tvar tBuffer = new Float32Array(4 * sw * sh); // target buffer Float32 rgb","\t\t\t\tvar sR = 0","\t\t\t\t\t, sG = 0","\t\t\t\t\t, sB = 0; // source's current point r,g,b","\t\t\t\t// untested !","\t\t\t\tvar sA = 0; //source alpha","","\t\t\t\tfor (sy = 0; sy < sh; sy++) {","\t\t\t\t\tty = sy * scale; // y src position within target","\t\t\t\t\ttY = 0 | ty; // rounded : target pixel's y","\t\t\t\t\tyIndex = 4 * tY * tw; // line index within target array","\t\t\t\t\tcrossY = (tY != (0 | ty + scale));","\t\t\t\t\tif (crossY) { // if pixel is crossing botton target pixel","\t\t\t\t\t\twy = (tY + 1 - ty); // weight of point within target pixel","\t\t\t\t\t\tnwy = (ty + scale - tY - 1); // ... within y+1 target pixel","\t\t\t\t\t}","\t\t\t\t\tfor (sx = 0; sx < sw; sx++, sIndex += 4) {","\t\t\t\t\t\ttx = sx * scale; // x src position within target","\t\t\t\t\t\ttX = 0 | tx; // rounded : target pixel's x","\t\t\t\t\t\ttIndex = yIndex + tX * 4; // target pixel index within target array","\t\t\t\t\t\tcrossX = (tX != (0 | tx + scale));","\t\t\t\t\t\tif (crossX) { // if pixel is crossing target pixel's right","\t\t\t\t\t\t\twx = (tX + 1 - tx); // weight of point within target pixel","\t\t\t\t\t\t\tnwx = (tx + scale - tX - 1); // ... within x+1 target pixel","\t\t\t\t\t\t}","\t\t\t\t\t\tsR = sBuffer[sIndex]; // retrieving r,g,b for curr src px.","\t\t\t\t\t\tsG = sBuffer[sIndex + 1];","\t\t\t\t\t\tsB = sBuffer[sIndex + 2];","\t\t\t\t\t\tsA = sBuffer[sIndex + 3];","","\t\t\t\t\t\tif (!crossX && !crossY) { // pixel does not cross","\t\t\t\t\t\t\t// just add components weighted by squared scale.","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * sqScale;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * sqScale;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * sqScale;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * sqScale;","\t\t\t\t\t\t} else if (crossX && !crossY) { // cross on X only","\t\t\t\t\t\t\tw = wx * scale;","\t\t\t\t\t\t\t// add weighted component for current px","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * w;","\t\t\t\t\t\t\t// add weighted component for next (tX+1) px","\t\t\t\t\t\t\tnw = nwx * scale","\t\t\t\t\t\t\ttBuffer[tIndex + 4] += sR * nw; // not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 5] += sG * nw; // not 4","\t\t\t\t\t\t\ttBuffer[tIndex + 6] += sB * nw; // not 5","\t\t\t\t\t\t\ttBuffer[tIndex + 7] += sA * nw; // not 6","\t\t\t\t\t\t} else if (crossY && !crossX) { // cross on Y only","\t\t\t\t\t\t\tw = wy * scale;","\t\t\t\t\t\t\t// add weighted component for current px","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * w;","\t\t\t\t\t\t\t// add weighted component for next (tY+1) px","\t\t\t\t\t\t\tnw = nwy * scale","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw] += sR * nw; // *4, not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 1] += sG * nw; // *4, not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 2] += sB * nw; // *4, not 3","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 3] += sA * nw; // *4, not 3","\t\t\t\t\t\t} else { // crosses both x and y : four target points involved","\t\t\t\t\t\t\t// add weighted component for current px","\t\t\t\t\t\t\tw = wx * wy;","\t\t\t\t\t\t\ttBuffer[tIndex] += sR * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 1] += sG * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 2] += sB * w;","\t\t\t\t\t\t\ttBuffer[tIndex + 3] += sA * w;","\t\t\t\t\t\t\t// for tX + 1; tY px","\t\t\t\t\t\t\tnw = nwx * wy;","\t\t\t\t\t\t\ttBuffer[tIndex + 4] += sR * nw; // same for x","\t\t\t\t\t\t\ttBuffer[tIndex + 5] += sG * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 6] += sB * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 7] += sA * nw;","\t\t\t\t\t\t\t// for tX ; tY + 1 px","\t\t\t\t\t\t\tnw = wx * nwy;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw] += sR * nw; // same for mul","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 1] += sG * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 2] += sB * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 3] += sA * nw;","\t\t\t\t\t\t\t// for tX + 1 ; tY +1 px","\t\t\t\t\t\t\tnw = nwx * nwy;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 4] += sR * nw; // same for both x and y","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 5] += sG * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 6] += sB * nw;","\t\t\t\t\t\t\ttBuffer[tIndex + 4 * tw + 7] += sA * nw;","\t\t\t\t\t\t}","\t\t\t\t\t} // end for sx","\t\t\t\t} // end for sy","","\t\t\t\t// create result canvas","\t\t\t\tvar resCV = document.createElement('canvas');","\t\t\t\tresCV.width = tw;","\t\t\t\tresCV.height = th;","\t\t\t\tvar resCtx = resCV.getContext('2d');","\t\t\t\tvar imgRes = resCtx.getImageData(0, 0, tw, th);","\t\t\t\tvar tByteBuffer = imgRes.data;","\t\t\t\t// convert float32 array into a UInt8Clamped Array","\t\t\t\tvar pxIndex = 0; //","\t\t\t\tfor (sIndex = 0, tIndex = 0; pxIndex < tw * th; sIndex += 4, tIndex += 4, pxIndex++) {","\t\t\t\t\ttByteBuffer[tIndex] = Math.ceil(tBuffer[sIndex]);","\t\t\t\t\ttByteBuffer[tIndex + 1] = Math.ceil(tBuffer[sIndex + 1]);","\t\t\t\t\ttByteBuffer[tIndex + 2] = Math.ceil(tBuffer[sIndex + 2]);","\t\t\t\t\ttByteBuffer[tIndex + 3] = Math.ceil(tBuffer[sIndex + 3]);","\t\t\t\t}","\t\t\t\t// writing result to canvas.","\t\t\t\tresCtx.putImageData(imgRes, 0, 0);","\t\t\t\t//downloadCTX.scale(2,2);","\t\t\t\tdownloadCTX.drawImage(resCV, Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetLeft) + Number(document.getElementById('paint').offsetLeft), Number(document.getElementById(\"rage-\" + droppedNumbers).parentElement.offsetTop) + Number(document.getElementById('paint').offsetTop), image.width + addedX, image.height + addedY);","\t\t\t\tresCtx.clearRect(0,0,resCV.width,resCV.height);","\t\t\t\t//stopDrawing();","\t\t\t\t//return resCV;","\t\t\t}","\t\t\tvar theScale = image.width *2 / originalImage.width;","\t\t\tvar addedX = 0;","\t\t\tvar addedY = 0;","","\t\t\tdownScaleCanvas(canvas2, theScale);","\t\t\t}","","\t\t}","\t\tfor (var textNumbers = 1; textNumbers <= textCalls; ++textNumbers) {","\t\t\tif (document.getElementById('text-' + textNumbers).classList.contains('red-textareas')) {","\t\t\t\tdownloadCTX.font= 32+\"px schoolbell\";","\t\t\t\tdownloadCTX.fillStyle = \"#d40000\";","\t\t\t\tadded1 = 0;","\t\t\t\tadded2 = 32;","\t\t\t\tdownloadCTX.fillText(document.getElementById('text-' + textNumbers).value.toUpperCase(), Number(document.getElementById('text-' + textNumbers).parentElement.parentElement.offsetLeft) + Number(document.getElementById('text-' + textNumbers).parentElement.offsetLeft) + added1, Number(document.getElementById('text-' + textNumbers).parentElement.parentElement.offsetTop) + Number(document.getElementById('text-' + textNumbers).parentElement.offsetTop) + added2);","\t\t\t\t//downloadCTX.save()","\t\t\t//document.getElementById('text-' + textNumbers).style.display = 'none';","\t\t\tconsole.log(document.getElementById('text-' + textNumbers).width);","\t\t\t}","","\t\t\telse {","\t\t\t\tdownloadCTX.font=\"20px schoolbell\";","\t\t\t\tdownloadCTX.fillStyle = \"black\";","\t\t\t\t//downloadCTX.save()","\t\t\t\tconsole.log('w')","\t\t\t\tadded1 = 1;","\t\t\t\tadded2 = 20;","\t\t\t\tdownloadCTX.fillText(document.getElementById('text-' + textNumbers).value, Number(document.getElementById('text-' + textNumbers).parentElement.parentElement.offsetLeft) + Number(document.getElementById('text-' + textNumbers).parentElement.offsetLeft) + Number(added1), Number(document.getElementById('text-' + textNumbers).parentElement.parentElement.offsetTop) + Number(document.getElementById('text-' + textNumbers).parentElement.offsetTop) + Number(added2));","\t\t\t//document.getElementById('text-' + textNumbers).style.display = 'none';","\t\t\tconsole.log(Number(document.getElementById('text-' + textNumbers).parentElement.parentElement.offsetLeft));","\t\t\tconsole.log(Number(document.getElementById('text-' + textNumbers).parentElement.parentElement.offsetLeft) + Number(document.getElementById('text-' + textNumbers).parentElement.offsetLeft)  )","\t\t\t}","\t\t};","\t\tfinalImage = $('<img/>').attr('src', downloadCANVAS.toDataURL())","\t\tif ( todownload === true ){","\t\t\t//$('#sketch-wrapper').append(downloadCANVAS)","\t\t\t//$(downloadCANVAS).css({'width':'600px'})","\t\t\t\tlink.href = downloadCANVAS.toDataURL();","\t\t\t\tlink.download = filename;","\t\t}","\t\telse {","\t\t\t$(finalImage).load(function(){","\t\t\t\tvar dataURL3 = downloadCANVAS.toDataURL();","\t\t\t\t$('#base64-2').val(dataURL3)","\t\t\t})","","\t\t    if ( image3 == false ) {","\t\t\t  \tconsole.log( downloadCANVAS.toDataURL() )","\t\t\t  \t$('<img/>').attr('src', downloadCANVAS.toDataURL()).load(function() {","\t\t\t  \t\t$(\"#submit-image-button-3\").click();","\t\t\t    \timage3 = true","\t\t\t    \t$('#ragefaces-buttons-wrapper').hide()","        \t\t\t$('#tools .loading-icon').addClass('loading-animation')","\t\t\t  \t})","","","\t\t    }","\t\t}","","\t}","","\t$(document).on('click', '#submit-image-button-before-3', function(){","\t\tif ( $('.choosen-content input[type=\"checkbox\"]:checked').length && $('.choosen-content:visible .anonymous-image').children('img').length  < 1 ) {","\t\t          \t$('.choosen-content:visible .anonymous-image').removeClass('buzz').hide().show().addClass('buzz')","\t\t\t  }","\t\telse if ( $('#rage-comics-content .inline-make-tags-wrapper .active-make-tag').length == 0  ) {","\t\t\t\t$('#rage-comics-content .inline-make-tags-wrapper').removeClass('buzz').hide()","\t\t\t\t\t\t.show().addClass('buzz')","\t\t\t}","\t\telse {","\t\t\tvar makeTagsArray = [];","\t\t\t\t\tfor ( i=0;i < $('#rage-comics-content .inline-make-tags-wrapper .active-make-tag').length ; i++ ) {","\t\t\t\t\t\tmakeTagsArray.push( $('#rage-comics-content .inline-make-tags-wrapper .active-make-tag').eq(i).attr('id').replace('tag-', '') )","\t\t\t\t\t}","\t\t\t\t\t$('#rage-comics-content .tag-list-field').val(makeTagsArray)","\t\t\t\t\tconsole.log(makeTagsArray)","\t\t\t$('#ragefaces-buttons-wrapper').fadeOut()","\t\t\tfinalImage = false;","\t\t    callDownload(this, 'downloadCanvas', 'ragecomic' + Math.round(Math.random()*500) + '.png', false);","\t\t}","","\t  })","\t//document.getElementsByClassName('rageface').setAttribute('crossOrigin', 'anonymous');","\t/**","\t * The event handler for the link's onclick event. We give THIS as a","\t * parameter (=the link element), ID of the canvas and a filename.","\t */","\t$(document).on('click', '.download-image', function(){","\t\tcallDownload(this, 'downloadCanvas', 'ragecomic' + Math.round(Math.random()*500) + '.png', true);","\t\tconsole.log('called to download')","\t});","var painting;","","","\t//var textCalls = 0;","\tvar textFocused = false;","\tfunction createText(e) {","\t\tfor ( i=0; i <= $('.textareas').length; i++  ) {","\t\t\tif ( $('.textareas').eq(i).val() == '' ) {","\t\t\t\t$('.textareas').eq(i).fadeOut(100).remove()","\t\t\t\ttextCalls -- ;","\t\t\t}","\t\t}","","\t\tif ( textFocused == false ) {","\t\tconsole.log(textFocused)","\t\t\tconsole.log('dfsdas');","\t\ttextCalls++;","\t\t//tmp_ctx.fillRect(0, 0, 56, 56);","\t\ttmp_canvas.removeEventListener('mousemove', onPaint, false);","\t\te.stopPropagation;","","\t\ttmp_canvas.removeEventListener('mousedown', function (e) {","\t\t\ttmp_canvas.removeEventListener('mousemove', onPaint, false);","","\t\t\tmouse.x = e.clientX //typeof e.offsetX !== 'undefined' ? e.offsetX : e.layerX;","\t\t\tmouse.y = e.clientY //typeof e.offsetY !== 'undefined' ? e.offsetY : e.layerY;","","\t\t\tstart_mouse.x = mouse.x;","\t\t\tstart_mouse.y = mouse.y;","","\t\t\tppts = [];","","\t\t\t//spraying tool.","\t\t\tsprayIntervalID = setInterval(onPaint, 50);","","\t\t\tonPaint();","\t\t\t//onPaintCircle();","","\t\t}, false);","\t\tvar onPaint = function () {","","\t\t\t// Tmp canvas is always cleared up before drawing.","\t\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","","\t\t\ttextarea.style.display = 'block';","\t\t};","\t\t// Tmp canvas is always cleared up before drawing.","\t\ttmp_ctx.clearRect(0, 0, tmp_canvas.width, tmp_canvas.height);","\t\tvar textarea = document.createElement('textarea');","\t\tsetTimeout(function(){","\t\t\t$(textarea).focus();","\t\t}, 100)","\t\t$(textarea).focus();","\t\tif (tool == 'text-#d40000') {","\t\t\ttextarea.className = 'textareas red-textareas';","\t\t\t//alert('true dat')","\t\t\ttmp_canvas.style.cursor = 'text';","\t\t}","\t\telse {","\t\t\ttextarea.className = 'textareas normal-textareas';","\t\t}","","\t\t//textarea.setAttribute(\"class\", \"text-\" + textCalls);","\t\t//textarea.addEventListener('mousedown', mouseDownOnTextarea);","\t\tsketch.appendChild(textarea);","\t\tvar x = e.clientX - canvas.offsetLeft","\t\t\t, y = e.clientY - canvas.offsetTop;","\t\t$(textarea).wrap(\"<div class='text-parent'></div>\");","\t\ttextarea.parentElement.style.top = e.offsetY + 'px';","\t\ttextarea.parentElement.style.left = e.offsetX + 'px';","\t\t//sconsole.log(e.clientX + \",\" + e.clientY);","\t\t//console.log(textarea.style.top + \",\" + textarea.style.left);","\t\t//console.log(document.getElementsByClassName('textareas').length);","\t\tvar textID = textarea.setAttribute(\"id\", \"text-\" + textCalls);","\t\t//textarea.parentElement.style.postion = 'relative';","\t\t$('.textareas').resizable({","\t\t\thandles: 'se'","\t\t, }).parent().draggable({","\t\t\tcancel: ''","\t\t\t, containment: sketch","\t\t\t, start: function () {","\t\t\t\t$(textarea).focus();","\t\t\t\t$('.ui-resizable-handle').css({});","","\t\t\t}","\t\t\t, stop: function () {","\t\t\t\t$(textarea).focus();","\t\t\t}","\t\t, });","\t\t//$('.textareas').dblclick(function(){","\t\t//  $(this).resizable();","\t\t//});","\t\t$('.textareas').click(function () {","\t\t\t$(this).focus();","\t\t\t$(this).siblings().fadeIn();","\t\t});","\t\tvar deleteHandle = document.createElement('div');","\t\t\t\tdeleteHandle.className = 'delete-handle animated-fast fadeIn';","\t\t\t\t$(deleteHandle).prependTo($(textarea).parent());","\t\t\t\t//var deleteHandle = document.createElement('div');","\t\t\t\t//deleteHandle.className = 'delete-handle';","\t\t\t\t//$(deleteHandle).prependTo($(theClone1).parent());","\t\t\t\t//$(theClone)","\t\t\t\t//$(this).wrap('<div class=\"img-parent\"></div>');","\t\t\t\t$(deleteHandle).click(function(){","\t\t\t\t\t$(this).parent().parent().remove();","\t\t\t\t\t//$(this).parent().remove();","\t\t\t\t\t//$(this).remove();","\t\t\t\t\t//$('#placeholder-1').addClass('cancel');","\t\t\t\t\ttextCalls--;","\t\t\t\t});","\t\t\t\t//$(theClone1).click(function(){","\t\t\t\t//\t$(theClone1).focus();","\t\t\t\t//});","\t\t\t\t$(textarea).parent().mouseenter(function(){","\t\t\t$(textarea).parent().find('.delete-handle').show();","\t\t\tconsole.log($(textarea).find('.delete-handle'))","\t\t\t});","\t\t\t$(textarea).parent().mouseleave(function () {","\t\t\t\t$(this).parent().find('.delete-handle').hide();","\t\t\t});","\t\ttmp_canvas.removeEventListener('click', createText, false);","\t\t}","\t\telse {","\t\t\treturn false;","\t\t}","","\t}//ends here","","","\tdroppedFaces = 0;","\t/*$(document).ready(function () {*/","","\t\t$('#tags p').click(function () {","\t\t\tvar tag = $(this).attr(\"id\");","\t\t\t$('.rageface').hide();","\t\t\t$('.' + tag).fadeIn(100);","\t\t\t$(\"#tags p\").removeClass('clickedTag');","\t\t\t$(this).addClass('clickedTag');","\t\t})","","\t\t$('#addRageFaces').click(function () {","\t\t\t$('#ragecontainer').fadeToggle(200);","\t\t\t$('#ragecontainer').toggleClass('clicked');","\t\t\t$('#add-button').hide();","\t\t\tif ($('#ragecontainer').hasClass('clicked')) {","\t\t\t\t$('#addRageFaces i').hide().text('remove').fadeIn(200)","\t\t\t} else {","\t\t\t\t$('#addRageFaces i').hide().text('add').fadeIn(200)","\t\t\t}","\t\t\t$('#tags p').addClass('animated-very-fast fadeInUp');","\t\t\t$('#ragefaces .rageface').slice(0,40).trigger(\"loadEmBoys\");","\t\t\t//tmp_canvas.removeEventListener('click', chooseBro);","","\t\t});","\t\t$(\"#ragefaces img.rageface\").slice(0,40).lazyload({","\t\t\tevent: 'loadEmBoys',","\t\t\t//effect : \"fadeIn\",","\t\t\tthreshold: 100,","","\t\t});","\t\t$(\"#ragefaces img.rageface\").slice(40,  $('#ragefaces .rageface').length ).lazyload({","\t\t    //effect : \"fadeIn\",","\t\t    container: $(\"#ragecontainer\"),","\t\t\tthreshold: 100,","\t\t\tevent: 'scrollstop'","\t\t});","","\t\t$('#tags p').click(function(){","\t\t\tvar thisTag = $(this).attr('id');","\t\t\tconsole.log(thisTag);","\t\t\t$('.'+thisTag).lazyload({","\t\t\t\tthreshold: 100,","\t\t\t})","\t\t});","\t\t/*dragg = function() {","\t\t\t$('.rageface.stock.ne').draggable({","\t\t\thelper: 'clone'","\t\t\t, appendTo: sketch","\t\t\t, revert: 'invalid'","\t\t\t, disabled: false","\t\t\t, start: function (event, ui) {","\t\t\t\t$('#ragecontainer').hide();","\t\t\t\t$(tmp_canvas).css({","\t\t\t\t\t'cursor': 'move'","\t\t\t\t});","\t\t\t\t$('#edit').click();","\t\t\t\t//$(ui.helper).animate({'width':'75','height':'auto'});","\t\t\t\t//if ( $(this).hasClass('panel2')) {","\t\t\t\t//\t$(ui.helper).addClass('dragged-panel2');","\t\t\t\t//}","\t\t\t}","","\t\t\t, stop: function (event, ui) {","\t\t\t\tdroppedFaces++;","\t\t\t\tvar currentFace = document.getElementById('rage' + droppedFaces);","\t\t\t\t$(ui.helper).addClass(\"dragged-helper\");","\t\t\t\tvar theClone1 = $(ui.helper).clone(true).removeClass('rageface ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable').addClass('dragged').attr('id', 'rage-' + droppedFaces).appendTo(sketch).wrap('<div class=\"img-parent\"></div>').resizable({","\t\t\t\t\taspectRatio: true","\t\t\t\t\t, minHeight: 50","\t\t\t\t\t, disabled: false","\t\t\t\t\t, handles: 'se'","\t\t\t\t\t, start: function () {","\t\t\t\t\t\t//$('.ui-wrapper').addClass('dragged-shadow');","\t\t\t\t\t\t//$(this).parent().addClass('img-wrapper');","\t\t\t\t\t}","\t\t\t\t\t, containment: sketch","\t\t\t\t}).parent().draggable({","\t\t\t\t\tcontainment: sketch","\t\t\t\t, });","\t\t\t\tvar deleteHandle = document.createElement('div');","\t\t\t\tdeleteHandle.className = 'delete-handle animated fadeIn';","\t\t\t\t$(deleteHandle).prependTo($(theClone1).parent().children());","\t\t\t\t$(deleteHandle).click(function(){","\t\t\t\t\t$(this).parent().parent().remove();","\t\t\t\t\t//$(this).parent().remove();","\t\t\t\t\t//$(this).remove();","\t\t\t\t\t$('#placeholder-1').addClass('cancel');","\t\t\t\t\tdroppedFaces--;","\t\t\t\t});","\t\t\t\t//$(theClone1).click(function(){","\t\t\t\t//\t$(theClone1).focus();","\t\t\t\t//});","\t\t\t\t$(theClone1).parent().mouseover(function(){","\t\t\t$(theClone1).find('.delete-handle').show();","\t\t\tconsole.log($(theClone1).find('.delete-handle'))","\t\t\t});","\t\t\t$(theClone1).parent().mouseout(function () {","\t\t\t\t$(this).find('.delete-handle').hide();","\t\t\t});","\t\t\t}","\t\t});","\t\t}*/","\t\tdragg = function(){","\t\t\t$('#ragefaces .rageface.rageface-normal:not(.panel2),#ragefaces .dragged.rageface-normal:not(.panel2)').draggable({","\t\t\thelper: 'clone'","\t\t\t, appendTo: sketch","\t\t\t, revert: 'invalid'","\t\t\t, disabled: false","\t\t\t, start: function (event, ui) {","\t\t\t\t$('#ragecontainer').hide();","\t\t\t\t$(tmp_canvas).css({","\t\t\t\t\t'cursor': 'move'","\t\t\t\t});","\t\t\t\t$('#edit').click();","\t\t\t\t//$(ui.helper).animate({'width':'75','height':'auto'});","\t\t\t\t//if ( $(this).hasClass('panel2')) {","\t\t\t\t//\t$(ui.helper).addClass('dragged-panel2');","\t\t\t\t//}","\t\t\t}","","\t\t\t, stop: function (event, ui) {","\t\t\t\tdroppedFaces++;","\t\t\t\tvar currentFace = document.getElementById('rage' + droppedFaces);","\t\t\t\t$(ui.helper).addClass(\"dragged-helper\");","\t\t\t\tvar theClone1 = $(ui.helper).clone(true).removeClass('rageface ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable').addClass('dragged').attr('id', 'rage-' + droppedFaces).appendTo(sketch).wrap('<div class=\"img-parent\"></div>').resizable({","\t\t\t\t\taspectRatio: true","\t\t\t\t\t, minHeight: 65","\t\t\t\t\t, disabled: false","\t\t\t\t\t, handles: 'se'","\t\t\t\t\t, start: function () {","\t\t\t\t\t\t//$('.ui-wrapper').addClass('dragged-shadow');","\t\t\t\t\t\t//$(this).parent().addClass('img-wrapper');","\t\t\t\t\t}","\t\t\t\t\t, containment: sketch","\t\t\t\t}).parent().draggable({","\t\t\t\t\tcontainment: sketch","\t\t\t\t, });","\t\t\t\t/*if ( !$(theClone).attr('facenumber') ) {","\t\t\t\t\t$(theClone).addClass('sto')","\t\t\t\t}*/","\t\t\t\tvar deleteHandle = document.createElement('div');","\t\t\t\tdeleteHandle.className = 'delete-handle animated fadeIn';","\t\t\t\t$(deleteHandle).prependTo($(theClone1).parent().children());","\t\t\t\t//var deleteHandle = document.createElement('div');","\t\t\t\t//deleteHandle.className = 'delete-handle';","\t\t\t\t//$(deleteHandle).prependTo($(theClone1).parent());","\t\t\t\t//$(theClone)","\t\t\t\t//$(this).wrap('<div class=\"img-parent\"></div>');","\t\t\t\t$(deleteHandle).click(function(){","\t\t\t\t\t$(this).parent().parent().remove();","\t\t\t\t\t//$(this).parent().remove();","\t\t\t\t\t//$(this).remove();","\t\t\t\t\t$('#placeholder-1').addClass('cancel');","\t\t\t\t\tdroppedFaces--;","\t\t\t\t});","\t\t\t\t//$(theClone1).click(function(){","\t\t\t\t//\t$(theClone1).focus();","\t\t\t\t//});","\t\t\t\t$(theClone1).parent().mouseover(function(){","\t\t\t$(theClone1).find('.delete-handle').show();","\t\t\tconsole.log($(theClone1).find('.delete-handle'))","\t\t\t});","\t\t\t$(theClone1).parent().mouseout(function () {","\t\t\t\t$(this).find('.delete-handle').hide();","\t\t\t});","\t\t\t}","\t\t});","\t\t}","\t\tdragg()","\t\t$('.rageface.panel2').draggable({","\t\t\thelper: 'clone',","\t\t\tappendTo: sketch,","\t\t\tstart: function(){","\t\t\t\t$('#ragecontainer').hide();","\t\t\t\t$('#edit').click();","\t\t\t\t//$('.placeholder').css({'z-index'});","\t\t\t}","\t\t\t, stop: function (event, ui) {","\t\t\t\tconsole.log('ss');","","\t\t\t},","\t\t});","\t\t$('#placeholder-1').droppable({","\t\t\thoverClass: 'border-2',","\t\t\taccept: $('.rageface.panel2'),","\t\t\tdrop: function(event,ui){","","\t\t\t\tdroppedFaces++;","\t\t\t\tvar currentFace = document.getElementById('rage' + droppedFaces);","\t\t\t\t$(ui.helper).addClass(\"dragged-helper\");","\t\t\t\tvar theClone2 = $(ui.helper).clone(true).removeClass('rageface ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable').addClass('dragged dragged-panel2').attr('id', 'rage-' + droppedFaces).appendTo(this).wrap('<div class=\"img-parent\"></div>');","\t\t\t\tconsole.log(theClone2)","\t\t\t\t//$(this).appendChild(theClone2);","\t\t\t\t//$(theClone2).appendTo('#panel2-holder');","\t\t\t\t//var dropIn = $(this)","\t\t\t\t//console.log(dropIn);","\t\t\t\t$(theClone2).css({'top':'0','left':'0'});","\t\t\t\t$(theClone2).animate({width: '750', height: '300'},200);","\t\t\t\ttheClone2.parent().parent()/*.draggable({","\t\t\t\t\tcontainment: sketch,","\t\t\t\t\t//appendTo: 'body',","\t\t\t\t\tgrid: [1, 300]","\t\t\t\t })*/.droppable({","\t\t\t\t\tdisabled: true,","\t\t\t\t});","\t\t\t\t$(theClone2).draggable({","\t\t\t\t\tdisabled: true,","\t\t\t\t})","\t\t\t\t//$('#sketch').sortable('refresh');","\t\t\t\tvar deleteHandle = document.createElement('div');","\t\t\t\tdeleteHandle.className = 'delete-handle animated fadeIn';","\t\t\t\t$(deleteHandle).prependTo($(theClone2).parent());","\t\t\t\t$(this).removeClass('cancel');","\t\t\t\t$(deleteHandle).click(function(){","\t\t\t\t\t$(this).parent().remove();","\t\t\t\t\t$(this).remove();","\t\t\t\t\t$('#placeholder-1').addClass('cancel').droppable({disabled:false});","\t\t\t\t\tdroppedFaces--;","\t\t\t\t});","\t\t\t\t$(tmp_canvas).addClass('default-cursor');","\t\t\t\t$('#ragecontainer').removeClass('clicked');","\t\t\t\t$('#add-button').hide();","\t\t\t\tdocument.getElementById('add-button').innerHTML = 'add';","\t\t\t\t$('#add-button').fadeIn();","\t\t\t$(theClone2).parent().mouseover(function(){","\t\t\t$(theClone2).siblings().show();","\t\t\tconsole.log($(theClone2))","\t\t\t});","\t\t\t$(theClone2).parent().mouseout(function () {","\t\t\t\t$(theClone2).siblings('.delete-handle').hide();","\t\t\t\tconsole.log($(theClone2).siblings('.delete-handle'))","\t\t\t});","\t\t\t}","\t\t});","\t\t$('#placeholder-wrapper').sortable({","\t\t\titems: \".placeholder\",","\t\t\ttolernce: 'touch',","\t\t\tcancel: '.cancel',","\t\t\tplaceholder:'border-3',","\t\t\t//containment: sketch,","\t\t\taxis:'y'","\t\t}).disableSelection();","\t\t$('#sketch').droppable({","\t\t\thoverClass: 'border'","\t\t\t, accept: \".rageface.rageface-normal , .dragged, .textareas, .img-parent\"","\t\t\t, tolerance: 'intersect'","\t\t\t, drop: function (event,ui) {","\t\t\t\t//$('.dragged-helper').removeClass('dragged-shadow');","\t\t\t\t$(tmp_canvas).addClass('default-cursor');","\t\t\t\t$('#ragecontainer').removeClass('clicked');","\t\t\t\t$('#add-button').hide();","\t\t\t\tdocument.getElementById('add-button').innerHTML = 'add';","\t\t\t\t$('#add-button').fadeIn();","\t\t\t\t//alert('dropped');","","","","\t\t\t}","\t\t, });","","\t\tvar dropIn = 'none';","","\t\t$('.delete-handle').click(function(){","\t\t\t$(this).parent().remove();","\t\t\t$(this).remove();","\t\t\talert('about to ');","\t\t});","","\t\t$('#more-tools').click(function () {","\t\t\t$('.hidden-tools').fadeToggle(200);","\t\t\t$(this).toggleClass('more-tools-rotation');","\t\t});","\t\t$(document).on('click', '#cancel-button-3', function(){","\t\t    $('#clear-button').click()","\t\t  })","\t\t$('#more-tools').click();","\t\t$('#black').click();","\t\t$('.splitter').click(splitting);","\t\t//m$('#remove-panel-button').fadeOut();","\t\t$('#add-panel').click(function () {","\t\t\taddPanel();","\t\t\t$('#placeholder-wrapper').sortable('refresh');","\t\t});","\t\t$('#remove-panel').click(removePanel);","\t\t$('#line2').click();","\t\t$('.line-wrapper').click(function () {","\t\t\t//$('.line-wrapper').css({","\t\t\t//\t'background':'#616161'","\t\t\t//});","\t\t\t$(this).css({","\t\t\t\t'background': 'rgb(239, 239, 237)',","\t\t\t\t'border': '1px solid rgb(255, 48, 0)'","\t\t\t});","\t\t});","","","","\t\t$('#shapes button').click(function () {","\t\t\t//var shape = $(this).attr('id');","\t\t\t//$('#shapes button').not(this).css({'border':'none'});","\t\t\tif (tool == 'rectangle') {","\t\t\t\t$('#shapes-button').html('<div id=\"replaced\" class=\"rectangle\"></div>')","\t\t\t} else if (tool == 'line') {","\t\t\t\t$('#shapes-button').html('<div id=\"replaced\" class=\"line\"></div>')","\t\t\t} else if (tool == 'circle') {","\t\t\t\t$('#shapes-button').html('<i id=\"replaced\" class=\"material-icons circle\">panorama_fish_eye</i>')","\t\t\t} else if (tool == 'ellipse') {","\t\t\t\t$('#shapes-button').html('<div id=\"replaced\" class=\"ellipse\"></div>')","\t\t\t}","\t\t});","\t\tvar textStyle = 'black';","\t\t$('#texts button').click(function(){","\t\t\tvar textStyle = $(this).attr('id').replace('text-','');","\t\t\tconsole.log(textStyle);","\t\t\t$('#texts-button').css({'color':textStyle});","\t\t\tconsole.log(tool);","\t\t});","\t\t$(document).on('focus','.textareas', function(){","\t\t\ttextFocused = true;","\t\t\tconsole.log(textFocused)","\t\t});","\t\t$(document).on('focusout','.textareas', function(){","\t\t\ttextFocused = false","\t\t\tconsole.log(textFocused)","\t\t});","","\t\t$('#colors, #sizes, #shapes, #texts').focusout(function () {","\t\t\tvar thisTool = $(this).attr('id');","\t\t\t//console.log(\"this\" + thisTool)","\t\t\t$('#' + thisTool + '-wrapper').fadeOut(400);","\t\t\t//console.log($('#' + thisTool + '-wrapper'));","\t\t\t//console.log($('#' + thisTool + ' .options'));","\t\t\t//console.log($('#' + thisTool + '-button'));","\t\t\t$('#' + thisTool + ' .options').removeClass('red-options');","\t\t\t$('#' + thisTool + '-button').removeClass('red-button');","\t\t\tif (tool == 'line' || tool == 'rectangle' || tool == 'ellipse' || tool == 'circle') {","\t\t\t\t$('#' + thisTool + '-button').css({","\t\t\t\t\t'background': '#F15247'","\t\t\t\t});","\t\t\t}","\t\t\telse if (tool == 'text-#d40000') {","\t\t\t\t$('#texts-button').children('.schoolbell-text').hide()","\t\t\t\t$('#texts-button').children('.text').eq(0).show()","\t\t\t\t$('#texts-button').css({'background':'#F15247'});","\t\t\t}","\t\t\telse if ( tool == 'text-black' ) {","\t\t\t\t$('#texts-button').children('.schoolbell-text').show()","\t\t\t\t$('#texts-button').children('.text').eq(0).hide()","\t\t\t\t$('#texts-button').css({'background':'#F15247'});","\t\t\t}","\t\t});","\t\t//$('#shapes').click(function(){","\t\t//  $('#line').click();","\t\t//});","\t\t$('#rectangle, #line, #circle, #ellipse, .hidden-wrapper, .color-box, .line-1, .line-2, .line-3').mousedown(function (e) {","\t\t\te.preventDefault();","\t\t});","\t\t$('#sizes, #shapes, #colors, #texts').hover(function (e) {","\t\t\te.preventDefault();","\t\t\tvar thisTool = $(this).attr('id');","\t\t\t//alert(thisTool);","\t\t\tconsole.log(\"this\" + thisTool);","\t\t\t$('#' + thisTool + '-wrapper').fadeToggle(300);","\t\t\t$('#' + thisTool + ' .options').toggleClass('red-options');","\t\t\t$('#' + thisTool + '-button').toggleClass('red-button');","","\t\t});","\t\t$('#splitter-1').click();","","\tfunction splitting(y) {","\t\tvar numberSplitter = Number($(this).attr('id').replace('splitter-', '') - 1);","\t\ty = 300 * numberSplitter;","\t\tconsole.log(y);","","\t\tfunction midLine() {","\t\t\ttmp_ctx.lineWidth = 2;","\t\t\ttmp_ctx.beginPath();","\t\t\ttmp_ctx.moveTo(375, y + 1);","\t\t\ttmp_ctx.lineTo(375, y + 299);","\t\t\ttmp_ctx.stroke();","\t\t}","\t\tconsole.log(this.innerHTML);","\t\tif (this.innerHTML == 'split') {","\t\t\ttmp_ctx.strokeStyle = \"#202020\";","\t\t\ttmp_ctx.lineWidth = 2;","\t\t\tmidLine();","\t\t\tconsole.log('splitted');","\t\t\tthis.innerHTML = \"unsplit\";","\t\t} else if (this.innerHTML == 'unsplit') {","\t\t\ttmp_ctx.strokeStyle = \"white\";","\t\t\tmidLine();","\t\t\tthis.innerHTML = \"split\";","\t\t\tconsole.log('unsplitted');","\t\t};","\t\ttmp_ctx.lineWidth = lineWidth;","\t\ttmp_ctx.lineJoin = 'round';","\t\ttmp_ctx.lineCap = 'round';","\t\ttmp_ctx.strokeStyle = lineColor;","\t\t//tmp_ctx.fillStyle = 'black';","\t\ttmp_ctx.lineWidth = lineWidth;","\t\t//tmp_ctx.restore();","\t\tstopDrawing();","\t};","","\t//document.getElementsByClassName('ragefacec').addEventListener('ondrop', undragshadow, false);","\tfunction addPanel() {","\t\tvar panelNumber = document.getElementsByClassName('splitter').length;","\t\t//console.log(panelNumber);","\t\tvar oldWidth = canvas.width;","\t\tvar oldHeight = canvas.height;","","\t\t//var oldWidthStyle = canvaso.ffsetWidth;","\t\t//$(document).ready(function(){","\t\tvar oldHeightStyle = $(canvas).height();","\t\t//})","","","\t\tvar prevCanvas = ctx.getImageData(0, 0, oldWidth, oldHeight);","","\t\ttmp_canvas.height = oldHeight + 600;","\t\tdocument.getElementById('paint').style.height = oldHeightStyle + 300 + 'px';","\t\tdocument.getElementById('tmp_canvas').style.height = oldHeightStyle + 300 + 'px';","\t\tdocument.getElementById('sketch').style.height = oldHeightStyle + 300 + 'px';","\t\tcanvas.height = oldHeight + 600;","\t\tctx.fillStyle = \"white\";","\t\tctx.fillRect(0, 0, canvas.width, canvas.height);","\t\tctx.putImageData(prevCanvas, 0, 0);","\t\tprevCanvas.crossOrigin = \"Anonymous\";","\t\t//ctx.fillStyle = \"black\";","\t\ttmp_ctx.strokeStyle = \"#202020\";","\t\t//tmp_ctx.scale(1,1);","\t\ttmp_ctx.lineWidth = '3';","\t\ttmp_ctx.moveTo(0, oldHeight);","\t\ttmp_ctx.lineTo(1500, oldHeight);","\t\ttmp_ctx.stroke();","\t\tstopDrawing();","\t\ttmp_ctx.restore();","\t\tsplitters = document.createElement('p');","\t\tsplitters.className = 'splitter';","\t\tsplitters.setAttribute(\"id\", \"splitter-\" + Number(panelNumber + 1));","\t\tsketch.appendChild(splitters);","\t\tsplitters.style.top = 150 + 300 * (panelNumber) + 'px';","\t\tsplitters.innerHTML = \"split\";","\t\tpanel2s = document.createElement('div');","\t\tpanel2s.className = 'placeholder cancel';","\t\tpanel2s.setAttribute(\"id\", \"placeholder-\" + Number(panelNumber +1 ));","\t\tdocument.getElementById('placeholder-wrapper').appendChild(panel2s);","\t\tpanel2s.style.top = 300 * (panelNumber) + 'px';","\t\t$(panel2s).droppable({","\t\t\thoverClass: 'border-2',","\t\t\taccept: $('.rageface.panel2, .dragged-panel2'),","\t\t\tdrop: function(event,ui){","\t\t\t\tvar thisPanel2 = $(this);","\t\t\t\tdroppedFaces++;","\t\t\t\tvar currentFace = document.getElementById('rage' + droppedFaces);","\t\t\t\t$(ui.helper).addClass(\"dragged-helper\");","\t\t\t\tvar theClone2 = $(ui.helper).clone(true).removeClass('rageface ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable').addClass('dragged dragged-panel2').attr('id', 'rage-' + droppedFaces).appendTo(this).wrap('<div class=\"img-parent\"></div>');","\t\t\t\tconsole.log(theClone2)","\t\t\t\t//$(this).appendChild(theClone2);","\t\t\t\t//$(theClone2).appendTo('#panel2-holder');","\t\t\t\t//var dropIn = $(this)","\t\t\t\t//console.log(dropIn);","\t\t\t\t$(tmp_canvas).addClass('default-cursor');","\t\t\t\t$('#ragecontainer').removeClass('clicked');","\t\t\t\t$('#add-button').hide();","\t\t\t\tdocument.getElementById('add-button').innerHTML = 'add';","\t\t\t\t$('#add-button').fadeIn();","\t\t\t\t$(theClone2).draggable({","\t\t\t\t\tdisabled: true,","\t\t\t\t});","\t\t\t\t$(theClone2).css({'position':'inherit'});","\t\t\t\t$(theClone2).animate({width: '750', height: '300'},200);","\t\t\t\ttheClone2.parent().parent().droppable({","\t\t\t\t\tdisabled: true,","\t\t\t\t});","\t\t\t\t$(this).removeClass('cancel');","\t\t\t\tvar deleteHandle = document.createElement('div');","\t\t\t\tdeleteHandle.className = 'delete-handle animated fadeIn';","\t\t\t\t$(deleteHandle).prependTo($(theClone2).parent());","\t\t\t\t$('#placeholder-wrapper').sortable('refresh');","\t\t\t\t$(deleteHandle).click(function(){","\t\t\t\t\t$(this).parent().remove();","\t\t\t\t\t$(this).remove();","\t\t\t\t\t$(thisPanel2).addClass('cancel').droppable({disabled:false});;","\t\t\t\t\tdroppedFaces--;","\t\t\t\t\t//alert(droppedFaces)","\t\t\t\t});","\t\t\t\t$(theClone2).parent().mouseover(function(){","\t\t\t$(theClone2).siblings().show();","\t\t\tconsole.log($(theClone2))","\t\t\t});","\t\t\t$(theClone2).parent().mouseout(function () {","\t\t\t\t$(theClone2).siblings('.delete-handle').hide();","\t\t\t\tconsole.log($(theClone2).siblings('.delete-handle'))","\t\t\t});","\t\t\t},","","\t\t});","\t\tsplitters.addEventListener('click', splitting, false);","\t\t//$(splitters).click();","\t\t//alert(oldHeightStyle);","\t\ttmp_ctx.scale(2, 2);","\t\t//ctx.scale(2,2);","","\t\t$('html, body').animate({","        scrollTop: $(\"#add-remove\").offset().top","    }, 1000);","\t\t$('#remove-panel-button').fadeIn();","\t};","","\tfunction removePanel() {","\t\tvar panelNumber = document.getElementsByClassName('splitter').length;","\t\t//console.log(panelNumber);","\t\tvar oldWidth = canvas.width;","\t\tvar oldHeight = canvas.height;","\t\t//var oldWidthStyle = canvaso.ffsetWidth;","\t\t//$(document).ready(function(){","\t\tvar oldHeightStyle = $(canvas).height();","\t\t//})","\t\tvar prevCanvas2 = ctx.getImageData(0, 0, oldWidth, oldHeight);","\t\ttmp_canvas.height = oldHeight - 600;","\t\tdocument.getElementById('paint').style.height = oldHeightStyle - 300 + 'px';","\t\tdocument.getElementById('tmp_canvas').style.height = oldHeightStyle - 300 + 'px';","\t\tdocument.getElementById('sketch').style.height = oldHeightStyle - 300 + 'px';","\t\tcanvas.height = oldHeight - 600;","","\t\tctx.fillStyle = \"white\";","\t\tctx.fillRect(0, 0, canvas.width, canvas.height);","\t\ttmp_ctx.putImageData(prevCanvas2, 0, 0);","\t\ttmp_ctx.strokeStyle = \"white\";","\t\ttmp_ctx.lineWidth = '2';","\t\ttmp_ctx.moveTo(0, oldHeight - 600);","\t\ttmp_ctx.lineTo(1500, oldHeight - 600);","\t\ttmp_ctx.stroke();","\t\ttmp_ctx.restore();","\t\tprevCanvas2.crossOrigin = \"Anonymous\";","\t\tvar lastSplitter = document.getElementById('splitter-' + panelNumber).remove();","\t\ttmp_ctx.scale(2, 2);","\t\tconsole.log(panelNumber);","\t\t$(\"#add-remove\").get(0).scrollIntoView(400);","\t\tstopDrawing();","\t\t//$('#placeholder-' + (panelNumber)).remove();","\t\t$('.placeholder:nth-child('+ panelNumber +')').remove();","\t\t//console.log($('.placeholder').index(panelNumber));","\t\tconsole.log($('#placeholder-' + panelNumber).parent());","\t\tpanelNumber--;","\t\tif ( $('#placeholder-' + panelNumber).hasClass('cancel') ) {","\t\t\tdroppedFaces--;","\t\t}","","\t\tif (document.getElementsByClassName('splitter').length == 1) {","\t\t\t//document.getElementById('remove-panel-button').style.display = 'none';","\t\t\t$('#remove-panel-button').fadeOut();","\t\t\t//alert('none');","\t\t}","","\t};","\tif (document.getElementsByClassName('splitter').length == 1) {","\t\t//document.getElementById('remove-panel-button').style.display = 'none';","\t\t$('#remove-panel-button').fadeOut();","\t\t//alert('none');","\t} else if (document.getElementsByClassName('splitter').length > 1) {","\t\t//document.getElementById('remove-panel-button').style.display = 'inline-block';","\t\t$('#remove-panel-button').fadeIn();","\t\t//alert('yes');","\t} else {","\t\t//alert('wgat');","\t}","","\tfunction addRage(){","\t\tdroppedFaces++;","\t}","","\t$('#upload-button, #clear-button').click(function(){","\t\t$(\"body\").get(0).scrollIntoView(500);","\t\tvar thisPopup = $('#'+ $(this).attr('id') + '-popup');","\t\tconsole.log(thisPopup);","\t\t$(thisPopup).addClass('show-upload');","\t\t$('.overlay').addClass('show-upload');","\t\t$('.overlay, .close, #no, #clear').click(function(){","\t\t\t$(thisPopup).removeClass('show-upload');","\t\t\t$('.overlay').removeClass('show-upload');","\t\t})","\t});","","\t$('#create-wrapper').focus(function(){","\t\t$('.create').css({'opacity':'1','display':'block'})","\t});","\t$('#create-wrapper').focusout(function(){","\t\t$('.create:nth-child(n+2)').css({'opacity':'0','display':'none'})","\t})","","\t$('.create:nth-child(n+2)').click(function(e){","\t\t$('.left-column').removeClass('fadeInLeft animated-delayed').addClass('fadeOutLeft animated');","\t\t$('.right-button').removeClass('animated-delayed rotateIn').addClass('rotateOut animated');","\t\t$('.middle-column').addClass('fadeOut animated');","\t\tvar toLoad = $(this).attr('id') + '.html' + ' #content';","\t\tconsole.log(toLoad);","\t\tsetTimeout(function() {","\t\t\t$( \"#content\" ).load( toLoad );","\t\t},1000);","\t\t$('.create:nth-child(n+2)').hide();","\t\tfunction loadJS(file) {","\t\t// DOM: Create the script element","\t\tvar jsElm = document.createElement(\"script\");","\t\t// set the type attribute","\t\tjsElm.type = \"text/javascript\";","\t\t// make the script element load file","\t\tjsElm.src = file;","\t\t// finally insert the element to the body element in order to load the script","\t\tdocument.body.appendChild(jsElm);","\t\t}","\t\tconsole.log($(this).attr('id') + '.js');","\t\t//loadJS( $(this).attr('id') + '.js');","","\t});","","","function readURL(input) {","  if (input.files && input.files[0]) {","","    var reader = new FileReader();","","    reader.onload = function(e) {","      //$('.image-upload-wrap').hide();","\t\tvar newRageface = document.createElement('img')","      $(newRageface).attr('src', e.target.result);","      //$('.file-upload-content').show();","\t$(newRageface).appendTo('#uploads');","\t\t$(newRageface).addClass('rageface rageface-normal animated-fast bigEntrance');","\t\tsetTimeout(function(){","\t\t\t$(newRageface).removeClass('bigEntrance')","\t\t}, 1000)","$(newRageface).draggable({","\t\t\thelper: 'clone'","\t\t\t, appendTo: $('#sketch')","\t\t\t, revert: 'invalid'","\t\t\t, disabled: false","\t\t\t, start: function (event, ui) {","\t\t\t\t$('#ragecontainer').hide();","\t\t\t\t$(tmp_canvas).css({","\t\t\t\t\t'cursor': 'move'","\t\t\t\t});","\t\t\t\t$('#edit').click();","\t\t\t\t//$(ui.helper).animate({'width':'75','height':'auto'});","\t\t\t\t//if ( $(this).hasClass('panel2')) {","\t\t\t\t//\t$(ui.helper).addClass('dragged-panel2');","\t\t\t\t//}","\t\t\t}","","\t\t\t, stop: function (event, ui) {","\t\t\t\t//droppedFaces = document.getElementsByClassName('dagged').length;","\t\t\t\tdroppedFaces++;","\t\t\t\tconsole.log(droppedFaces);","\t\t\t\tvar currentFace = document.getElementById('rage' + droppedFaces);","\t\t\t\t$(ui.helper).addClass(\"dragged-helper\");","\t\t\t\tvar theClone1 = $(ui.helper).clone(true).removeClass('bigEntrance rageface ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable').addClass('dragged').attr('id', 'rage-' + droppedFaces).appendTo($('#sketch')).wrap('<div class=\"img-parent\"></div>').resizable({","\t\t\t\t\taspectRatio: true","\t\t\t\t\t, minHeight: 75","\t\t\t\t\t, disabled: false","\t\t\t\t\t, handles: 'se'","\t\t\t\t\t, start: function () {","\t\t\t\t\t\t//$('.ui-wrapper').addClass('dragged-shadow');","\t\t\t\t\t\t//$(this).parent().addClass('img-wrapper');","\t\t\t\t\t}","\t\t\t\t\t, containment: sketch","\t\t\t\t}).parent().draggable({","\t\t\t\t\tcontainment: $('#sketch'),","\t\t\t\t\tappendTo: $('#sketch'),","\t\t\t\t });","\t\t\t\tvar deleteHandle = document.createElement('div');","\t\t\t\tdeleteHandle.className = 'delete-handle animated-fast fadeIn';","\t\t\t\t$(deleteHandle).prependTo($(theClone1).parent().children());","\t\t\t\t//var deleteHandle = document.createElement('div');","\t\t\t\t//deleteHandle.className = 'delete-handle';","\t\t\t\t//$(deleteHandle).prependTo($(theClone1).parent());","\t\t\t\t//$(theClone)","\t\t\t\t//$(this).wrap('<div class=\"img-parent\"></div>');","\t\t\t\t$(deleteHandle).click(function(){","\t\t\t\t\t$(this).parent().parent().remove();","\t\t\t\t\t//$(this).parent().remove();","\t\t\t\t\t//$(this).remove();","\t\t\t\t\t$('#placeholder-1').addClass('cancel');","\t\t\t\t\tdroppedFaces--;","\t\t\t\t});","\t\t\t\t//$(theClone1).click(function(){","\t\t\t\t//\t$(theClone1).focus();","\t\t\t\t//});","\t\t\t\t$(theClone1).parent().mouseover(function(){","\t\t\t\t\t$('#addRageFaces i').hide().text('remove').fadeIn(200)","\t\t\t$(theClone1).find('.delete-handle').show();","\t\t\tconsole.log($(theClone1).find('.delete-handle'))","\t\t\t});","\t\t\t$(theClone1).parent().mouseout(function () {","\t\t\t\t$(this).find('.delete-handle').hide();","\t\t\t});","\t\t\t}","\t\t});","      //$('.image-title').html(input.files[0].name);","    };","","    reader.readAsDataURL(input.files[0]);","","  } else {","    removeUpload();","  }","\t//$(\"<a href='#'></a>\").click().$('#rageface').click();","\t//$('.overlay, .popup').hide();","\t$('.popup').removeClass('show-upload');","\t$('.overlay').removeClass('show-upload');","}","$('.image-upload-wrap').bind('dragover', function () {","\t\t$('.image-upload-wrap').addClass('image-dropping');","\t});","\t$('.image-upload-wrap').bind('dragleave', function () {","\t\t$('.image-upload-wrap').removeClass('image-dropping');","});","//}","","","//alert('functions')","}","","$(document).ready(","\t\tfunctions","","","",");","$(document).on('page:load', function(){","\t\tfunctions;","\t}",")"],"id":1}],[{"start":{"row":90,"column":0},"end":{"row":90,"column":2},"action":"remove","lines":["\t\t"],"id":2}]]},"timestamp":1496427300000}