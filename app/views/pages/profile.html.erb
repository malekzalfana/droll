<body id="<%= controller.action_name %>">
    <% if @user == current_user %>
        <%= form_for current_user, :html => { :multipart => true , :class => 'hidden' },:url => url_for(:controller => 'pages', :action => 'checkUsername', :user_id => current_user.id ), :method => "get" , remote: true  do |f| %>
            <%= f.text_field :name, :value => @user.username, :id => 'username-check-field' %>
            <%= f.submit "Save", id: 'username-check-submit'%>
        <% end %>
    <% end %>
    
    <%= render '/layouts/activities' %>
    <div id="overlay-under-notif"></div>
<div id="cover-photo">
    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
      <div class="hidden">
        <%= f.file_field :image, id: "edit-profile-image-field", :onchange => "previewProfileImage(event)" %>
      </div>
      <div class="hidden">
          <%= f.text_field :bio, :value => @user.bio, id: "profile-bio-field" %>
      </div>
      <div class="hidden">
          <%= f.text_field :username, :value => @user.username, id: "profile-username-field" %>
      </div>
      <div class="hidden">
        <%= f.file_field :cover, id: 'edit-profile-cover-field', :onchange => "previewProfileCover(event)" %>
      </div>
    
      <div class="actions">
        <%= f.submit "Update", id: 'save-profile-field' %>
      </div>
    <% end %>
    <div id="profile-under-overlay" style="background-image: url(<%= if (@user.cover.url == "missing-2.jpg") then "/assets/" end %><%= @user.cover.url(:medium) %>)" ></div>
    <div id="profile-overlay"></div>
    <div id="profile-account-id-wrapper">
    <% if @user.image.url == "missing.jpg" %>
        <div id="profile-photo" style="background-image: url(/assets/<%= @user.image.url(:thumb) %>)"><i class="material-icons fadeInUp animated-fast" id="edit-profile-image">edit</i></div>
    <% else %>
        <div id="profile-photo" style="background-image: url(<%= @user.image.url(:medium) %>)"><i class="material-icons fadeInUp animated-fast" id="edit-profile-image">edit</i></div>
    <% end %>
    <h2 id="username-profile-big"><%= @username %></h2>
    <i class="material-icons" id="username-check-icon">check_circle</i>
    </div>
    <p id="username-profile"><%= @user.bio unless @user.bio.blank? %></p>
    <i class="material-icons fadeInUp animated-fast" id="edit-profile-cover">edit</i>
</div>
<div id="content-profile">
    <div id="profile-info">
            <i id="cancel-edit-profile" class="material-icons">clear</i>
            <div id="save-profile"><i class="material-icons">done</i></div>
            <% if @user == current_user %>
            <i class="material-icons" id="edit-profile">edit</i>
            <% end %>
            <% if user_signed_in? && @user == current_user %><a href="https://drolle-2-malekzalfana.c9users.io/settings"><i id="setting-button" class="material-icons">settings</i></a><% end %>
            <%= render '/layouts/follow_button', :user => User.find_by_username(params[:id]) %>
            <h2 id="posts-number"><%= @user.posts.count %> Posts</h2>
            <h2 id="upvotes-number"><%= @user.following.count %> Following</h2>
            <h2 id="upvotes-number"><%= @user.followers.count %> Followers</h2>
        </div>
    <div id="profile-titles">
        <span class="selected-profile-posts profile-tabs" id="profile-posts">Posts</span><span class="profile-tabs" id="profile-favors">Favorites</span>
    </div>
    <div id="left-content-profile">
        <%= will_paginate @profilepost %>
        <% if @user.posts.count == 0 %>
            <div class="notice-message-fixed"><%= @user.username %> hasn't posted anything yet.</div>
        <% else %>
        <% @profilepost.each do |x| %>
            <%= link_to(x) do %>
            <div class="wrapper">
                <div class="wrapper-content">
                    <div class="profile-post-overlay"></div>
                <h2 class="post-title"><%= x.title %></h2>
                <div class="profile-post" style="background-image: url(<%= x.image.url(:medium) %>)"></div>
                <div class="profile-post-options">
                    <span class="post-votes-word"><%=  x.get_upvotes.size - x.get_downvotes.size %> points</span>
                    <%= link_to dislike_post_path(x), method: :put, class: 'down downvote', :"data-post-id" => x.id, remote: true  do %>
                    <% end %>
                    <%= link_to like_post_path(x), method: :put, class: 'up upvote', :"data-post-id" => x.id, remote: true  do %>
                    <% end %>
                </div>
                </div>
                
            </div>
            <% end %>
        <% end %>
    <% end %>
    </div>
    <div id="right-content-profile">
        <%= will_paginate @profilefavor %>
        <% if !@user.votes.where(:vote_scope => 'favor').for_type(Post).votables.blank? %>
        <% @profilefavor.each do |y| %>
        <%= link_to(y) do %>
        <div class="wrapper">
            <div class="profile-post-overlay"></div>
            <h2 class="post-title"><%= y.title %></h2>
            <span class="profile-post-user">@<%= y.user.username %></span>
            <div class="profile-post" style="background-image: url(<%= y.image.url(:medium) %>)"></div>
                <div class="profile-post-options">
                    <span class="post-votes-word"><%=  y.get_upvotes.size - y.get_downvotes.size %> points</span>
                    <%= link_to dislike_post_path(y), method: :put, class: 'down downvote', :"data-post-id" => y.id, remote: true  do %>
                    <% end %>
                    <%= link_to like_post_path(y), method: :put, class: 'up upvote', :"data-post-id" => y.id, remote: true  do %>
                    <% end %>
                </div>
            </div>
        <% end %>    
        <% end %>
        <% else %>
        <div class="notice-message-fixed"><%= @user.username %> hasn't favoured anything yet.</div>
        <% end %>
    </div>
</div>
</body>